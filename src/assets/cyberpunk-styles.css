/* =============================
   CyberSurvivor Unified UI Skin
   - Only edit this file for UI styling *per user request*
   - Goal: Consistent panel + tab layout across all screens
   - Added: CSS variables, shared panel + tab primitives
   ============================= */

/* Design Tokens */
:root {
  --ui-font: 'Orbitron', sans-serif;
  --ui-bg: linear-gradient(135deg, #0f0820, #1a0d2e, #16213e);
  --ui-surface: rgba(0, 0, 0, 0.45);
  --ui-surface-alt: rgba(0, 0, 0, 0.6);
  --ui-border: rgba(0,255,255,0.35);
  --ui-border-strong: #00ffff;
  --ui-accent: #ff0080;
  --ui-accent-soft: rgba(255,0,128,0.15);
  --ui-gold: #FFD700;
  --ui-text-main: #00ffff;
  --ui-text-muted: rgba(255,255,255,0.65);
  --ui-radius-xs: 4px;
  --ui-radius-sm: 6px;
  --ui-radius-md: 10px;
  --ui-radius-lg: 15px;
  --ui-radius-xl: 28px;
  --ui-gap-xs: 4px;
  --ui-gap-sm: 8px;
  --ui-gap-md: 12px;
  --ui-gap-lg: 20px;
  --ui-gap-xl: 32px;
  --ui-panel-max-width: 1280px;
  --ui-transition: 0.25s cubic-bezier(.4,.14,.3,1);
  --ui-shadow-glow: 0 0 20px rgba(0,255,255,.35), 0 0 40px rgba(255,0,128,.25);
  --ui-scrollbar-track: rgba(255,255,255,0.06);
  --ui-scrollbar-thumb: rgba(0,255,255,0.4);
}

/* === Global base layout (moved from inline <style> blocks to satisfy stricter CSP) === */
body { margin:0; overflow:hidden; font-family: var(--ui-font, 'Orbitron', sans-serif); }
canvas { display:block; position:absolute; top:0; left:0; z-index:0; }
#main-menu { z-index:1; }

@font-face {
  font-family: 'Orbitron';
  /* NOTE: Provide the actual Orbitron variable font at this path. Placeholder path adjusted for build (self-host only). */
  src: local('Orbitron'), url('./fonts/Orbitron-VariableFont_wght.woff2') format('woff2');
  font-weight: 100 900;
  font-display: swap;
}
html, body { font-family: 'Orbitron', sans-serif; }

/* Global font application across project (buttons, inputs, headings) */
html, body, button, input, select, textarea, h1, h2, h3, h4, h5, h6, .ui-panel, .menu-button, .character-box, .character-info-box, .logo-text, .logo-subtext {
  font-family: 'Orbitron', sans-serif;
}

/* === Loading overlay (migrated from inline for CSP) === */
.loading-overlay { position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#050510; z-index:1000; font-family:'Orbitron',sans-serif; color:#0ff; letter-spacing:1px; }
.loading-title { font-size:38px; margin-bottom:18px; text-shadow:0 0 12px #00ffff,0 0 24px #0088ff; }
.loading-status { font-size:14px; margin-bottom:12px; opacity:0.85; }
.loading-bar-shell { width:380px; max-width:80%; height:14px; border:2px solid #0ff; box-shadow:0 0 10px #0ff inset,0 0 10px #0ff; position:relative; border-radius:8px; overflow:hidden; }
.loading-bar-fill { position:absolute; left:0; top:0; height:100%; width:0; background:linear-gradient(90deg,#00ffff,#00aaff,#00ffff); box-shadow:0 0 12px #00ffff; transition:width .18s ease-out; }
.loading-tip { margin-top:14px; font-size:11px; color:#7dd; opacity:0.7; }

/* Scrollbar (webkit + chrome/edge) */
*::-webkit-scrollbar { width: 10px; }
*::-webkit-scrollbar-track { background: var(--ui-scrollbar-track); }
*::-webkit-scrollbar-thumb { background: var(--ui-scrollbar-thumb); border-radius: 6px; }
*::-webkit-scrollbar-thumb:hover { background: rgba(0,255,255,0.65); }

/* Shared Panel Primitive */
.ui-panel {
  box-sizing: border-box;
  background: var(--ui-surface);
  backdrop-filter: blur(12px);
  border: 2px solid var(--ui-border);
  border-radius: var(--ui-radius-lg);
  padding: var(--ui-gap-xl) var(--ui-gap-lg);
  color: var(--ui-text-main);
  font-family: var(--ui-font);
  display: flex;
  flex-direction: column;
  position: relative;
  max-width: var(--ui-panel-max-width);
  width: 100%;
  box-shadow: var(--ui-shadow-glow);
}

.ui-panel.compact { padding: var(--ui-gap-lg) var(--ui-gap-md); }

/* Unified Tabs */
.ui-tabs { display: flex; gap: 0; border-bottom: 2px solid var(--ui-border); flex-shrink: 0; }
.ui-tab {
  flex: 1 1 0;
  background: var(--ui-surface-alt);
  color: var(--ui-text-muted);
  font: 600 0.9rem/1 var(--ui-font);
  letter-spacing: 1px;
  text-transform: uppercase;
  padding: 14px 16px;
  border: none;
  cursor: pointer;
  position: relative;
  transition: var(--ui-transition);
  display: flex; align-items: center; justify-content: center;
}
.ui-tab:focus-visible { outline: 2px solid var(--ui-accent); outline-offset: 2px; }
.ui-tab:hover { background: rgba(0,255,255,0.12); color: var(--ui-text-main); }
.ui-tab.active { background: rgba(0,255,255,0.22); color: var(--ui-text-main); }
.ui-tab.active::after { content: ''; position: absolute; left: 0; bottom: 0; width: 100%; height: 3px; background: var(--ui-accent); box-shadow:0 0 12px var(--ui-accent); }

/* Tab Content Wrapper enforces consistent intrinsic height so panels don't jump when switching */
.ui-tab-panels { position: relative; flex: 1 1 auto; display: flex; flex-direction: column; min-height: 0; }
.ui-tab-panel { flex: 1 1 auto; display: none; flex-direction: column; gap: var(--ui-gap-lg); overflow-y: auto; padding: var(--ui-gap-lg) var(--ui-gap-md); animation: fadeIn 0.4s ease; }
.ui-tab-panel.active { display: flex; }
/* Slightly tighter default text rhythm */
.ui-tab-panel { line-height: 1.35; }

/* Compact text utility (apply class to any container) */
.compact-text, .compact-text p, .compact-text li { line-height: 1.18; margin-bottom: .4em; }
.compact-text h1, .compact-text h2, .compact-text h3 { line-height:1.12; margin: .55em 0 .35em; }
.compact-text .stat-box { padding: 8px; }

/* Density utilities */
.gap-xs{gap:var(--ui-gap-xs);} .gap-sm{gap:var(--ui-gap-sm);} .gap-md{gap:var(--ui-gap-md);} .gap-lg{gap:var(--ui-gap-lg);} .gap-xl{gap:var(--ui-gap-xl);}

/* Harmonised character select panel (removed earlier duplicate definition, merged styles with later full-screen variant) */
.character-select-panel {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  font-family: var(--ui-font);
  color: var(--ui-text-main);
  background: var(--ui-bg);
  overflow: hidden;
  z-index: 1500; /* use highest of the two previous values */
  box-sizing: border-box;
}

.character-select-content {
  display: flex;
  flex-direction: row;
  align-items: stretch; /* Stretch items to fill height */
  justify-content: center;
  gap: 30px; /* Smaller gap for better spacing */
  width: 100%;
  max-width: 1200px; /* Smaller max-width for wider screens */
  flex-wrap: wrap; /* Allow content to wrap on smaller screens */
  z-index: 2; /* Ensure content is above panel background */
}

.character-grid-and-buttons {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  gap: 20px; /* Smaller gap between grid and buttons */
  flex-grow: 1; /* Allow this section to grow */
  max-width: 900px; /* Smaller max width for the grid and buttons section */
  z-index: 2;
}

.menu-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 2.5em; /* Smaller title */
  color: #FFD700;
  text-shadow: 0 0 20px #00FFFF, 0 0 40px #FF00FF; /* Smaller glow */
  margin: 0 0 20px 0; /* Less space below title */
  text-align: center;
  width: 100%;
  letter-spacing: 0.08em; /* Slightly smaller letter spacing */
  z-index: 2;
}

.character-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr); /* Explicitly 6 columns */
  grid-template-rows: repeat(2, 1fr); /* Explicitly 2 rows */
  gap: 16px; /* Smaller gap for grid items */
  background: rgba(10, 20, 30, 0.4); /* More transparent background */
  backdrop-filter: blur(8px); /* Frosted glass effect */
  border-radius: 18px;
  box-shadow: 0 0 28px #00FFFF66, 0 0 56px #FF00FF33; /* Smaller shadow */
  padding: 20px 16px;
  min-width: 720px; /* Smaller min-width for 6 columns */
  max-width: 900px;
  justify-items: center;
  align-items: center;
  margin: 0 auto;
  z-index: 2;
}

.character-grid-second-row {
  display: none; /* This is no longer needed with explicit 2x6 grid */
}

.character-box {
  background: linear-gradient(135deg, #1a1a3e 0%, #28285a 100%); /* Darker gradient */
  border: 3px solid #00FFFF; /* Thicker border */
  border-radius: 20px;
  box-shadow: 0 0 28px #00FFFF, 0 0 60px #FF00FF; /* Stronger shadow */
  color: #FFD700;
  font-family: 'Orbitron', sans-serif;
  font-size: 1em; /* Smaller font */
  padding: 10px 5px;
  min-width: 100px;
  min-height: 70px;
  text-align: center;
  cursor: pointer;
  transition: box-shadow 0.2s, transform 0.2s, border-color 0.2s; /* Faster transition */
  user-select: none;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 2;
}
.character-box.selected {
  border: 3px solid #FFD700; /* Thinner selected border */
  box-shadow: 0 0 30px #FFD700, 0 0 60px #00FFFF; /* Smaller selected shadow */
  transform: scale(1.08); /* Less pronounced scale */
}
.character-box:hover {
  border-color: #FF00FF;
  box-shadow: 0 0 30px #FF00FF, 0 0 60px #00FFFF;
  transform: scale(1.05);
}
.character-portrait {
  width: 60px; /* Smaller portrait for details panel */
  height: 60px;
  border-radius: 12px;
  margin-bottom: 10px;
  box-shadow: 0 0 14px #00FFFFBB, 0 0 28px #FF00FF77; /* Smaller shadow */
  background: #282828;
  object-fit: cover;
  align-self: center;
  z-index: 2;
}

.character-info-box {
  background: rgba(25,25,40,0.9); /* Slightly less opaque */
  backdrop-filter: blur(12px); /* Stronger frosted glass */
  border-radius: 28px;
  box-shadow: 0 0 56px #00FFFF66, 0 0 112px #FF00FF33;
  padding: 40px 50px;
  color: #FFFFFF;
  font-family: 'Orbitron', sans-serif;
  font-size: 1.1em; /* Smaller font */
  letter-spacing: 0.03em;
  min-width: 300px;
  max-width: 400px;
  min-height: 200px;
  margin: 0;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: flex-start;
  position: relative;
  align-self: stretch;
  z-index: 2;
}
.character-info-box h2 {
  color: #FFD700;
  font-size: 1.8em; /* Smaller heading */
  margin-bottom: 10px;
  text-shadow: 0 0 10px #FF00FF, 0 0 20px #00FFFF; /* Smaller glow */
}
.character-info-box p {
  color: #E0E0FF;
  font-size: 1em;
  margin-bottom: 6px;
}
.character-info-box .stat {
  color: #00FFFF;
  font-size: 1em;
  margin-bottom: 4px;
}
.character-info-box .traits {
  margin-top: 12px;
  color: #88FF99;
  font-size: 0.9em;
}
.character-info-box .weapon {
  margin-top: 12px;
  color: #FFD700;
  font-size: 0.9em;
}

.character-select-actions {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  gap: 16px;
  width: 100%;
  margin-top: 30px;
  z-index: 2;
}

.menu-button {
  font-size: 1.5em;
  margin: 0;
  padding: 10px 25px;
  border-radius: 10px;
  background: linear-gradient(90deg, #1a1a3e 0%, #28285a 100%);
  color: #FFD700;
  border: none;
  box-shadow: 0 0 14px #FF00FF, 0 0 30px #00FFFF;
  cursor: pointer;
  transition: background 0.2s, box-shadow 0.2s, transform 0.2s;
  font-family: 'Orbitron', sans-serif;
  display: inline-block;
  width: auto;
  min-width: 150px;
  max-width: 250px;
  box-sizing: border-box;
  vertical-align: middle;
  z-index: 2;
}
.menu-button:hover {
  background: linear-gradient(90deg, #28285a 0%, #1a1a3e 100%);
  box-shadow: 0 0 30px #FFD700, 0 0 60px #00FFFF;
  transform: scale(1.05);
}

/* ===== CYBERPUNK MAIN MENU ===== */
.cyberpunk-main-menu {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #0f0820, #1a0d2e, #16213e);
  display: flex;
  flex-direction: column;
  z-index: 1000;
  font-family: 'Orbitron', monospace;
  color: #00ffff;
  overflow: hidden;
}

.matrix-bg-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 25% 25%, rgba(0, 255, 255, 0.05) 0%, transparent 50%),
    radial-gradient(circle at 75% 75%, rgba(255, 0, 255, 0.05) 0%, transparent 50%);
  z-index: -1;
}

.main-menu-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 30px 50px;
  border-bottom: 2px solid rgba(0, 255, 255, 0.3);
  background: rgba(0, 0, 0, 0.3);
}

.game-logo {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

.logo-text {
  font-size: 3rem;
  font-weight: 900;
  text-shadow: 0 0 20px #00ffff, 0 0 40px #00ffff;
  letter-spacing: 8px;
  background: linear-gradient(45deg, #00ffff, #ff0080);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}

.logo-subtext {
  font-size: 1.2rem;
  letter-spacing: 4px;
  color: rgba(255, 255, 255, 0.7);
  margin-top: -8px;
}

.currency-display {
  display: flex;
  align-items: center;
  background: rgba(0, 255, 255, 0.1);
  border: 2px solid #00ffff;
  border-radius: 25px;
  padding: 10px 20px;
  font-size: 1.5rem;
  font-weight: 700;
}

.currency-icon {
  margin-right: 10px;
  font-size: 2rem;
  animation: pulse 2s infinite;
}

.main-menu-content {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 50px;
  gap: 100px;
}

.menu-navigation {
  display: flex;
  flex-direction: column;
  gap: 20px;
  min-width: 300px;
}

.cyberpunk-btn {
  position: relative;
  background: rgba(0, 0, 0, 0.8);
  border: 2px solid #00ffff;
  color: #00ffff;
  font-family: inherit;
  font-size: 1.2rem;
  font-weight: 600;
  padding: 15px 30px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 2px;
  overflow: hidden;
  min-height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cyberpunk-btn.primary-btn {
  border-color: #ff0080;
  color: #ff0080;
  background: rgba(255, 0, 128, 0.1);
}

.cyberpunk-btn:hover {
  transform: translateX(5px);
  box-shadow: 0 0 30px currentColor;
}

.cyberpunk-btn:hover .btn-glow {
  opacity: 1;
  width: 100%;
}

.btn-glow {
  position: absolute;
  top: 0;
  left: -100%;
  width: 0%;
  height: 100%;
  background: linear-gradient(90deg, transparent, currentColor, transparent);
  opacity: 0;
  transition: all 0.5s ease;
}

.notification-dot {
  position: absolute;
  top: -5px;
  right: -5px;
  width: 12px;
  height: 12px;
  background: #ff0080;
  border-radius: 50%;
  animation: pulse 1.5s infinite;
}

.menu-preview {
  flex: 1;
  max-width: 600px;
}

.selected-character-preview {
  background: rgba(0, 0, 0, 0.6);
  border: 2px solid rgba(0, 255, 255, 0.5);
  border-radius: 15px;
  padding: 40px;
  text-align: center;
  backdrop-filter: blur(10px);
}

.preview-title {
  font-size: 1.5rem;
  margin-bottom: 30px;
  color: rgba(255, 255, 255, 0.8);
  letter-spacing: 3px;
}

.preview-portrait {
  width: 200px;
  height: 200px;
  margin: 0 auto 30px;
  border: 3px solid #00ffff;
  border-radius: 50%;
  overflow: hidden;
  position: relative;
}

.preview-portrait img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.preview-name {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: #00ffff;
}

.preview-stats {
  display: flex;
  justify-content: space-around;
  margin-top: 20px;
}

.stat-item {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.stat-label {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 5px;
}

.stat-value {
  font-size: 1.8rem;
  font-weight: 700;
  color: #ff0080;
}

.main-menu-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 50px;
  border-top: 2px solid rgba(0, 255, 255, 0.3);
  background: rgba(0, 0, 0, 0.3);
}

.version-info {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.5);
}

.connection-status {
  display: flex;
  align-items: center;
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.7);
}

.status-dot {
  width: 8px;
  height: 8px;
  background: #00ff00;
  border-radius: 50%;
  margin-right: 10px;
  animation: pulse 2s infinite;
}

/* ===== CYBERPUNK MODALS ===== */
.cyberpunk-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
  backdrop-filter: blur(5px);
}

.modal-content {
  background: linear-gradient(135deg, #0f0820, #1a0d2e);
  border: 2px solid #00ffff;
  border-radius: 15px;
  padding: 40px;
  max-width: 90%;
  max-height: 90%;
  overflow-y: auto;
  font-family: 'Orbitron', monospace;
  color: #00ffff;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
  border-bottom: 2px solid rgba(0, 255, 255, 0.3);
  padding-bottom: 20px;
}

.modal-header h2 {
  font-size: 2rem;
  margin: 0;
  text-shadow: 0 0 10px #00ffff;
}

.close-btn {
  background: none;
  border: 2px solid #ff0080;
  color: #ff0080;
  font-size: 1.5rem;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s ease;
}

.close-btn:hover {
  background: #ff0080;
  color: white;
  box-shadow: 0 0 20px #ff0080;
}

.upgrades-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.upgrade-item {
  background: rgba(0, 0, 0, 0.4);
  border: 2px solid rgba(0, 255, 255, 0.3);
  border-radius: 10px;
  padding: 20px;
  display: flex;
  align-items: center;
  gap: 15px;
  transition: all 0.3s ease;
}

.upgrade-item:hover {
  border-color: #00ffff;
  background: rgba(0, 255, 255, 0.1);
}

.upgrade-icon {
  font-size: 2.5rem;
  width: 60px;
  text-align: center;
}

.upgrade-info {
  flex: 1;
}

.upgrade-name {
  font-size: 1.3rem;
  font-weight: 600;
  margin-bottom: 5px;
}

.upgrade-level {
  color: #ff0080;
  font-weight: 700;
  margin-bottom: 5px;
}

.upgrade-cost {
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.9rem;
}

.upgrade-btn {
  background: rgba(255, 0, 128, 0.2);
  border: 2px solid #ff0080;
  color: #ff0080;
  padding: 10px 20px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
}

.upgrade-btn:hover {
  background: #ff0080;
  color: white;
  box-shadow: 0 0 20px #ff0080;
}

.stats-content {
  margin-top: 20px;
}

.stats-content h3 {
  color: #00ffff;
  margin-bottom: 15px;
  font-size: 1.5rem;
}

.score-item {
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(0, 255, 255, 0.3);
  border-radius: 5px;
  padding: 10px 15px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
}

.no-scores {
  text-align: center;
  color: rgba(255, 255, 255, 0.5);
  padding: 40px;
  font-style: italic;
}

/* ===== CHARACTER CAROUSEL ===== */
.character-select-panel {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  background: linear-gradient(135deg, #0f0820, #1a0d2e, #16213e);
  display: flex;
  flex-direction: column;
  z-index: 1500;
  font-family: 'Orbitron', monospace;
  color: #00ffff;
  overflow: hidden;
  box-sizing: border-box;
}

.carousel-header {
  padding: 28px 34px 24px 34px;
  border-bottom: 2px solid rgba(0, 255, 255, 0.3);
  background: rgba(0, 0, 0, 0.28);
  text-align: center;
  flex-shrink: 0;
}

.carousel-title {
  font-size: 2.5rem;
  font-weight: 900;
  text-shadow: 0 0 20px #00ffff;
  letter-spacing: 6px;
  margin-bottom: 10px;
  background: linear-gradient(45deg, #00ffff, #ff0080);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}

.carousel-subtitle {
  color: rgba(255, 255, 255, 0.7);
  font-size: 1rem;
  letter-spacing: 2px;
}

.carousel-container {
  flex: 1 1 auto;
  display: flex;
  position: relative;
  overflow: hidden;
  width: 100%;
  height: 100%;
  min-height: 0;
  box-sizing: border-box;
  padding: 0 34px 0 34px;
  gap: 34px;
}

.carousel-main {
  flex: 1 1 0;
  min-width: 0; /* Allow flexbox to shrink without overflow */
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 20px 32px;
  position: relative;
  box-sizing: border-box;
}

.character-display {
  text-align: center;
  max-width: 500px; /* Slightly smaller max-width */
  width: 100%; /* Ensure it takes full available width */
  margin: 0 auto; /* Center the character display horizontally */
}

.character-portrait {
  width: 280px; /* Slightly smaller */
  height: 280px;
  margin: 0 auto 20px; /* Reduced bottom margin */
  border: 3px solid #00ffff; /* Slightly thinner border */
  border-radius: 15px; /* Slightly smaller radius */
  overflow: hidden;
  position: relative;
  box-shadow: 0 0 25px rgba(0, 255, 255, 0.4); /* Subtler glow */
  transition: all 0.3s ease;
}

.character-portrait:hover {
  transform: scale(1.03); /* Smaller hover effect */
  box-shadow: 0 0 35px rgba(0, 255, 255, 0.6);
}

.character-portrait img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.character-name {
  font-size: 2.2rem; /* Slightly smaller */
  font-weight: 700;
  margin-bottom: 15px; /* Reduced margin */
  color: #00ffff;
  text-shadow: 0 0 12px #00ffff;
  letter-spacing: 2px; /* Reduced spacing */
}

.character-class {
  font-size: 1.1rem; /* Slightly smaller */
  color: #ff0080;
  margin-bottom: 20px; /* Reduced margin */
  text-transform: uppercase;
  letter-spacing: 1.5px; /* Reduced spacing */
}

.navigation-arrows {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 10;
}

.nav-arrow {
  background: rgba(0, 0, 0, 0.8);
  border: 2px solid #00ffff;
  color: #00ffff;
  font-size: 1.6rem; /* Slightly adjusted */
  width: 50px; /* Slightly smaller */
  height: 50px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.nav-arrow:hover {
  background: rgba(0, 255, 255, 0.2);
  box-shadow: 0 0 15px #00ffff; /* Smaller glow */
  transform: scale(1.05); /* Smaller scale */
}

/* Inline portrait nav container */
.portrait-nav {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20px;
  width: 100%;
  max-width: 560px;
  margin: 0 auto 12px;
}
.portrait-nav .character-portrait { margin: 0; }

/* Remove absolute offset adjustments when inside inline layout */
.portrait-nav .nav-arrow.prev,
.portrait-nav .nav-arrow.next { position: static; left:auto !important; right:auto !important; }

/* Stabilize arrow sizing to avoid layout shift on hover */
.portrait-nav .nav-arrow { flex: 0 0 50px; will-change: transform; }
.portrait-nav .nav-arrow:hover { transform: none; box-shadow: 0 0 18px #00ffff, 0 0 28px var(--ui-accent); }
.portrait-nav .nav-arrow:active { transform: translateY(1px); }

/* Reduce gap & portrait size slightly on smaller widths for stability */
@media (max-width: 900px) {
  .portrait-nav { gap: 14px; }
  .portrait-nav .nav-arrow { width:46px; height:46px; font-size:1.4rem; }
  .portrait-nav .character-portrait { width:240px; height:240px; }
}
@media (max-width: 600px) {
  .portrait-nav { gap: 10px; }
  .portrait-nav .nav-arrow { width:42px; height:42px; font-size:1.3rem; }
  .portrait-nav .character-portrait { width:200px; height:200px; }
}

.carousel-thumbnails {
  position: absolute;
  bottom: 15px; /* Moved up slightly */
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 12px; /* Slightly smaller gap */
  z-index: 10;
  max-width: 90%; /* Prevent overflow */
  overflow-x: auto; /* Allow horizontal scroll if needed */
  padding: 5px;
}

.thumbnail {
  width: 70px; /* Smaller thumbnails */
  height: 70px;
  border: 2px solid rgba(0, 255, 255, 0.3);
  border-radius: 8px; /* Smaller radius */
  overflow: hidden;
  cursor: pointer;
  transition: all 0.3s ease;
  opacity: 0.6;
  flex-shrink: 0; /* Prevent shrinking */
}

.thumbnail:hover {
  border-color: #00ffff;
  transform: scale(1.03); /* Smaller hover effect */
  opacity: 0.8;
}

.thumbnail.active {
  border-color: #ff0080;
  box-shadow: 0 0 12px #ff0080; /* Smaller glow */
  opacity: 1;
  transform: scale(1.06); /* Smaller active scale */
}

.thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.info-panel {
  flex: 1 1 0;
  min-width: 0; /* Prevent overflow clipping on right */
  background: rgba(0, 0, 0, 0.4);
  border-left: 2px solid rgba(0, 255, 255, 0.3);
  overflow-y: auto;
  backdrop-filter: blur(10px);
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}

.info-tabs {
  display: flex;
  border-bottom: 2px solid rgba(0, 255, 255, 0.3);
  flex-shrink: 0; /* Prevent tabs from shrinking */
}

.info-tab {
  flex: 1;
  background: rgba(0, 0, 0, 0.6);
  border: none;
  color: rgba(255, 255, 255, 0.7);
  font-family: inherit;
  font-size: 0.9rem; /* Slightly smaller */
  font-weight: 600;
  padding: 15px; /* Reduced padding */
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.info-tab:hover {
  background: rgba(0, 255, 255, 0.1);
  color: #00ffff;
}

.info-tab.active {
  background: rgba(0, 255, 255, 0.2);
  color: #00ffff;
  border-bottom: 3px solid #ff0080;
}

.tab-content {
  padding: 20px; /* Reduced padding */
  line-height: 1.35; /* Match unified panel default */
  flex: 1; /* Take up remaining space */
  display: flex;
  flex-direction: column;
  justify-content: flex-start; /* Always align to top */
  align-items: stretch; /* Stretch items to full width instead of flex-start */
  overflow-y: auto; /* Allow scrolling if needed */
}

.tab-content > * {
  align-self: stretch; /* Force all children to take full width */
  text-align: left; /* Align text to left instead of center */
}

.tab-content h3 {
  color: #00ffff;
  margin-bottom: 15px; /* Reduced margin */
  font-size: 1.3rem; /* Slightly smaller */
  text-shadow: 0 0 8px #00ffff;
  flex-shrink: 0; /* Prevent title from shrinking */
  text-align: left; /* Force left alignment */
  width: 100%;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px; /* Reduced gap */
  margin-bottom: 20px; /* Reduced margin */
  flex-shrink: 0; /* Prevent grid from shrinking */
  width: 100%; /* Full width */
  justify-self: stretch; /* Stretch to container width */
  align-self: stretch; /* Stretch to container width */
  box-sizing: border-box; /* Include padding in width calculation */
}
.stats-grid.cols-3 { grid-template-columns: repeat(3, 1fr); }

.stat-box {
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(0, 255, 255, 0.3);
  border-radius: 6px; /* Smaller radius */
  padding: 12px; /* Reduced padding */
  text-align: center;
  min-height: 60px; /* Ensure consistent height */
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.stat-label {
  font-size: 0.8rem; /* Smaller text */
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 4px; /* Reduced margin */
  text-transform: uppercase;
  letter-spacing: 1px;
}

.stat-value {
  font-size: 1.6rem; /* Slightly smaller */
  font-weight: 700;
  color: #ff0080;
  text-shadow: 0 0 8px #ff0080;
}

.weapon-info {
  background: rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(0, 255, 255, 0.3);
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 20px;
  flex-shrink: 0; /* Prevent shrinking */
  width: 100%; /* Full width */
  align-self: stretch; /* Stretch to container width */
  text-align: left; /* Force left alignment */
  box-sizing: border-box; /* Include padding in width calculation */
}
.weapon-core-stats {
  display: grid;
  grid-template-columns: repeat(auto-fill,minmax(90px,1fr));
  gap: 8px;
  margin: 10px 0 14px;
}
.weapon-core-stat { background: rgba(0,0,0,0.35); border:1px solid rgba(0,255,255,0.25); border-radius:6px; padding:6px 8px; display:flex; flex-direction:column; align-items:flex-start; }
.weapon-core-stat .w-label { font-size:0.6rem; letter-spacing:1px; text-transform:uppercase; color:var(--ui-text-muted); }
.weapon-core-stat .w-val { font-size:1.05rem; font-weight:600; color:var(--ui-accent); text-shadow:0 0 6px var(--ui-accent); }
.weapon-traits { list-style:none; display:flex; flex-wrap:wrap; gap:6px; margin:4px 0 12px; padding:0; }
.weapon-traits li { font-size:0.65rem; letter-spacing:1px; padding:4px 8px; background:linear-gradient(135deg,rgba(0,255,255,0.15),rgba(255,0,128,0.15)); border:1px solid rgba(0,255,255,0.25); border-radius:999px; text-transform:uppercase; color:#fff; }
.weapon-lore { font-size:0.75rem; letter-spacing:1px; font-style:italic; color:rgba(255,255,255,0.75); background:rgba(255,255,255,0.04); border-left:3px solid var(--ui-accent); padding:8px 12px; border-radius:4px; box-shadow:0 0 10px rgba(255,0,128,0.25) inset; }

.weapon-name {
  color: #ff0080;
  font-weight: 700;
  font-size: 1.3rem;
  margin-bottom: 10px;
  text-align: left; /* Force left alignment */
}

.weapon-description {
  color: rgba(255, 255, 255, 0.8);
  margin-bottom: 15px;
  min-height: 40px; /* Ensure consistent height */
  text-align: left; /* Force left alignment */
}

.weapon-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  width: 100%; /* Full width */
  box-sizing: border-box; /* Include padding in width calculation */
}

.weapon-stat {
  text-align: center;
  padding: 8px;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 5px;
}

.lore-text {
  color: rgba(255, 255, 255, 0.8);
  font-style: italic;
  line-height: 1.8;
  margin-bottom: 20px;
  flex: 1; /* Take up available space */
  width: 100%; /* Full width */
  align-self: stretch; /* Stretch to container width */
  box-sizing: border-box; /* Include padding in width calculation */
}

.lore-quote {
  background: rgba(0, 255, 255, 0.1);
  border-left: 4px solid #00ffff;
  padding: 20px;
  margin: 20px 0;
  font-style: italic;
  color: #00ffff;
  flex-shrink: 0; /* Prevent shrinking */
  width: 100%; /* Full width */
  align-self: stretch; /* Stretch to container width */
  box-sizing: border-box; /* Include padding in width calculation */
}

/* Add a spacer div for consistent tab heights */
.tab-spacer {
  flex: 1;
  min-height: 50px; /* Smaller minimum space */
  width: 100%; /* Full width */
}

.carousel-footer {
  padding: 20px 34px 28px 34px;
  border-top: 2px solid rgba(0, 255, 255, 0.3);
  background: rgba(0,0,0,0.28);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-shrink: 0;
}

.select-button {
  background: linear-gradient(45deg, #ff0080, #00ffff);
  border: none;
  color: white;
  font-family: inherit;
  font-size: 1.3rem;
  font-weight: 700;
  padding: 15px 40px;
  border-radius: 30px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 2px;
  box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
  position: relative;
  overflow: hidden;
}

.select-button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 40px rgba(255, 0, 128, 0.8);
}

.select-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s ease;
}

.select-button:hover::before {
  left: 100%;
}

.back-button {
  background: rgba(0, 0, 0, 0.8);
  border: 2px solid #00ffff;
  color: #00ffff;
  font-family: inherit;
  font-size: 1.1rem;
  font-weight: 600;
  padding: 12px 25px;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.back-button:hover {
  background: rgba(0, 255, 255, 0.1);
  box-shadow: 0 0 15px #00ffff;
}

/* ===== ANIMATIONS ===== */
@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.7; transform: scale(1.05); }
}

@keyframes slideInLeft {
  from { transform: translateX(-50px); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes slideInRight {
  from { transform: translateX(50px); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.character-display {
  animation: fadeIn 0.5s ease;
}

.nav-arrow.prev:hover {
  animation: slideInLeft 0.3s ease;
}

.nav-arrow.next:hover {
  animation: slideInRight 0.3s ease;
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 1200px) {
  .main-menu-content {
    gap: 50px;
    padding: 30px;
  }
  .carousel-container { padding: 0 12px; }
  .carousel-main { padding: 16px 20px; }
  
  .character-portrait {
    width: 250px;
    height: 250px;
  }
  
  .nav-arrow.prev {
    left: -80px;
  }
  
  .nav-arrow.next {
    right: -80px;
  }
}

@media (max-width: 768px) {
  .carousel-container {
    flex-direction: column;
  }
  
  .info-panel {
    border-left: none;
    border-top: 2px solid rgba(0, 255, 255, 0.3);
    max-height: 300px;
  }
  
  .character-portrait {
    width: 200px;
    height: 200px;
  }
  
  .nav-arrow {
    width: 50px;
    height: 50px;
    font-size: 1.5rem;
  }
  
  .nav-arrow.prev {
    left: -60px;
  }
  
  .nav-arrow.next {
    right: -60px;
  }
  
  .carousel-thumbnails {
    gap: 10px;
  }
  
  .thumbnail {
    width: 60px;
    height: 60px;
  }
}
#character-select-canvas {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  z-index: 0; /* Place behind all other content */
}

/* --- Upgrade Panel Styles --- */
/* Overlay container */
#upgrade-panel.upgrade-panel-overlay {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  background: linear-gradient(145deg, rgba(0,0,10,0.92) 0%, rgba(10,0,20,0.92) 60%, rgba(0,20,30,0.9) 100%);
  backdrop-filter: blur(6px) saturate(140%);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: clamp(12px, 3vw, 40px);
  box-sizing: border-box;
}
#upgrade-panel.upgrade-panel-overlay.hidden { display: none; }

/* Panel shell */
.upgrade-panel.ui-panel {
  display: flex;
  flex-direction: column;
  gap: 20px;
  width: min(1100px, 100%); /* widened to fit 3 fixed cards */
  border: 2px solid var(--color-accent-cyan, #00ffff);
  background: linear-gradient(165deg, rgba(20,30,50,0.85) 0%, rgba(15,15,35,0.88) 55%, rgba(10,12,30,0.92) 100%);
  box-shadow: 0 0 24px #00ffff55, 0 0 64px #ff00ff22;
  border-radius: 18px;
  padding: 28px clamp(18px,2.2vw,40px) 24px;
  position: relative;
  overflow: hidden;
  transform: scale(var(--panel-scale, 1));
  transform-origin: center center;
}
.upgrade-panel.ui-panel:before, .upgrade-panel.ui-panel:after {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
}
.upgrade-panel.ui-panel:before {
  background: radial-gradient(circle at 15% 20%, rgba(0,255,255,0.18), transparent 60%),
              radial-gradient(circle at 85% 75%, rgba(255,0,255,0.15), transparent 55%);
  mix-blend-mode: overlay;
}
.upgrade-panel.ui-panel:after {
  border: 1px solid rgba(255,255,255,0.05);
  border-radius: inherit;
  box-shadow: inset 0 0 4px rgba(255,255,255,0.08);
}

.upgrade-header { display:flex; flex-direction:column; gap:4px; }
.upgrade-header .panel-title {
  font-family: 'Orbitron', sans-serif;
  font-size: clamp(1.8rem,3.2vw,2.6rem);
  font-weight:700;
  letter-spacing:1px;
  color: var(--color-accent-cyan,#00ffff);
  text-shadow: 0 0 14px #00ffffaa, 0 0 34px #ff00ffaa;
  margin:0;
}
.upgrade-hint { font-size:0.75rem; opacity:0.65; letter-spacing:0.08em; text-transform:uppercase; }

.upgrade-options-grid {
  display:grid;
  grid-template-columns: repeat(3, 300px); /* exactly 3 cards per row */
  gap: 22px;
  justify-content:center;
  justify-items:center;
}
.upgrade-options-grid.fixed-three { grid-template-columns:repeat(3,300px)!important; }
.upgrade-options-grid.fixed-three .upgrade-card { width:300px; }
/* Prevent media queries from collapsing columns when fixed-three is present */
@media (max-width: 1280px) {
  .upgrade-options-grid.fixed-three { grid-template-columns:repeat(3,260px)!important; }
  .upgrade-options-grid.fixed-three .upgrade-card { width:260px; }
}
@media (max-width: 980px) {
  .upgrade-options-grid.fixed-three { grid-template-columns:repeat(3,240px)!important; }
  .upgrade-options-grid.fixed-three .upgrade-card { width:240px; }
}
@media (max-width: 780px) {
  .upgrade-options-grid.fixed-three { grid-template-columns:repeat(3,210px)!important; }
  .upgrade-options-grid.fixed-three .upgrade-card { width:210px; height:175px; }
}
@media (max-width: 680px) {
  .upgrade-options-grid.fixed-three { grid-template-columns:repeat(3,190px)!important; }
  .upgrade-options-grid.fixed-three .upgrade-card { width:190px; height:170px; }
}
@media (max-width: 600px) {
  .upgrade-options-grid.fixed-three { grid-template-columns:repeat(3,170px)!important; }
  .upgrade-options-grid.fixed-three .upgrade-card { width:170px; height:160px; padding:10px 10px 30px; }
}
@media (max-width: 540px) {
  .upgrade-options-grid.fixed-three { grid-template-columns:repeat(3,150px)!important; }
  .upgrade-options-grid.fixed-three .upgrade-card { width:150px; height:150px; padding:8px 8px 26px; }
  .upgrade-options-grid.fixed-three .upgrade-icon { width:42px; height:42px; }
  .upgrade-options-grid.fixed-three .upgrade-icon img { width:40px; height:40px; }
  .upgrade-options-grid.fixed-three .upgrade-title { font-size:.8rem; }
  .upgrade-options-grid.fixed-three .upgrade-desc { font-size:.55rem; -webkit-line-clamp:3; line-clamp:3; }
}

/* Responsive scaling tiers for upgrade panel/cards */
@media (max-width: 1280px) {
  .upgrade-panel.ui-panel { width:min(100%, 1000px); }
  .upgrade-options-grid { grid-template-columns: repeat(3, 260px); gap:18px; }
  .upgrade-card { width:260px; height:175px; padding:12px 12px 36px 12px; }
  .upgrade-progress-wrapper { left:12px; right:12px; bottom:8px; }
  .upgrade-icon { width:52px; height:52px; }
  .upgrade-icon img { width:48px; height:48px; }
  .upgrade-title { font-size:.95rem; }
  .upgrade-desc { -webkit-line-clamp:3; line-clamp:3; }
}
@media (max-width: 980px) {
  .upgrade-panel.ui-panel { width:min(100%, 860px); }
  .upgrade-options-grid { grid-template-columns: repeat(2, 260px); }
}
@media (max-width: 640px) {
  .upgrade-panel.ui-panel { width:min(100%, 420px); }
  .upgrade-options-grid { grid-template-columns: repeat(1, 260px); }
}

.upgrade-card {
  --border-color: var(--color-accent-cyan,#00ffff);
  position:relative;
  display:flex;
  flex-direction:column;
  width:300px;
  height:190px; /* fixed height */
  padding:14px 14px 40px 14px; /* reserve bottom space for level bar */
  background: linear-gradient(145deg, rgba(25,40,65,0.55) 0%, rgba(18,22,48,0.70) 60%, rgba(15,18,38,0.9) 100%);
  border:1px solid var(--border-color);
  border-radius:14px;
  cursor:pointer;
  text-align:left;
  color: #e3f6ff;
  font-family: 'Orbitron', sans-serif;
  transition: background .22s ease, transform .18s ease, box-shadow .25s ease, border-color .25s ease;
  overflow:hidden;
}
.upgrade-card:before {
  content:'';
  position:absolute;
  inset:0;
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0));
  opacity:0.4;
  pointer-events:none;
}
.upgrade-card:after {
  content:'';
  position:absolute;
  left:0; top:0; bottom:0;
  width:4px;
  background: linear-gradient(180deg, var(--border-color), transparent);
  opacity:0.85;
}
.upgrade-card:hover, .upgrade-card:focus-visible {
  outline:none;
  transform: translateY(-3px) scale(1.015);
  box-shadow: 0 0 0 1px var(--border-color), 0 0 18px 4px var(--border-color);
  background: linear-gradient(155deg, rgba(40,70,110,0.75) 0%, rgba(25,30,70,0.85) 55%, rgba(18,20,50,0.95) 100%);
}
.upgrade-card.is-weapon { --border-color: #00fff2; }
.upgrade-card.is-passive { --border-color: #ff9d00; }
.upgrade-card.is-class { box-shadow: 0 0 0 1px #00fff2, 0 0 26px 6px #00fff299; }

.upgrade-key-indicator {
  position:absolute;
  top:8px; left:10px;
  width:32px; height:32px;
  display:flex; align-items:center; justify-content:center;
  font-size:0.95rem; font-weight:600;
  background: linear-gradient(140deg,#091d22,#0e2d35);
  border:1px solid var(--border-color);
  border-radius:8px;
  color: var(--border-color);
  text-shadow:0 0 6px var(--border-color);
  box-shadow:0 0 10px var(--border-color) inset, 0 0 8px var(--border-color);
}
.upgrade-icon { width:56px; height:56px; flex:0 0 auto; display:flex; align-items:center; justify-content:center; margin-bottom:4px; }
.upgrade-icon.top-right { position:absolute; top:8px; right:10px; margin-bottom:0; }
.upgrade-icon.top-right img { width:48px; height:48px; }
.upgrade-icon img { width:52px; height:52px; object-fit:contain; filter: drop-shadow(0 0 6px rgba(0,255,255,0.5)); }
/* Passive (green arrow) SVG styling */
.upgrade-icon .passive-arrow { filter: drop-shadow(0 0 6px #00ff99) drop-shadow(0 0 12px #00ff9966); }
/* Passive icon framed (orange theme) */
/* Passive icon inherits same base frame; only glow tint differs */
.upgrade-card.is-passive .upgrade-icon.top-right { top:8px; right:10px; }
.upgrade-card.is-passive .upgrade-icon.top-right .passive-arrow { width:52px; height:52px; }
/* When icon is top-right, push text body below it */
.upgrade-icon.top-right + .upgrade-body { margin-top:50px; }
@media (max-width: 780px) { .upgrade-icon.top-right + .upgrade-body { margin-top:46px; } }
@media (max-width: 600px) { .upgrade-icon.top-right + .upgrade-body { margin-top:42px; } }
.upgrade-body { flex:1; display:flex; flex-direction:column; gap:4px; overflow:hidden; }
.upgrade-row { display:flex; justify-content:space-between; gap:10px; align-items:flex-start; }
.upgrade-title-line { display:flex; gap:8px; align-items:center; flex-wrap:nowrap; }
.upgrade-title { font-size:1.05rem; letter-spacing:.5px; font-weight:600; color:#fff; text-shadow:0 0 8px var(--border-color); line-height:1.05; }
.upgrade-type-line { font-size:.6rem; opacity:.75; letter-spacing:.15em; text-transform:uppercase; font-weight:500; }
.upgrade-desc { font-size:.70rem; line-height:1.15; opacity:.84; font-weight:400; flex:1; overflow:hidden; display:-webkit-box; -webkit-line-clamp:4; line-clamp:4; -webkit-box-orient:vertical; }

/* Adaptive text scaling inside fixed box */
.upgrade-card .upgrade-title, .upgrade-card .upgrade-desc { transition: font-size .15s ease; }
.upgrade-card[data-text-small="1"] .upgrade-title { font-size:.95rem; }
.upgrade-card[data-text-small="1"] .upgrade-desc { font-size:.64rem; }
.upgrade-card[data-text-small="2"] .upgrade-title { font-size:.88rem; }
.upgrade-card[data-text-small="2"] .upgrade-desc { font-size:.58rem; }

.badge { display:inline-flex; align-items:center; justify-content:center; font-size:.55rem; line-height:1; padding:4px 6px 3px; border-radius:6px; letter-spacing:.05em; font-weight:600; text-transform:uppercase; background:#222; border:1px solid currentColor; }
.badge-weapon { color:#00fff2; background:linear-gradient(140deg,#012d31,#023f44); }
.badge-passive { color:#ff9d00; background:linear-gradient(140deg,#331d00,#4a2900); }
.badge-class { color:#ff2ad4; background:linear-gradient(140deg,#38002d,#4d0040); }
.badge-skip { color:#8aa1b1; background:linear-gradient(140deg,#202a32,#2e3a44); }

.upgrade-progress-wrapper { position:absolute; left:14px; right:14px; bottom:10px; display:flex; justify-content:center; }
.upgrade-progress { position:relative; width:100%; max-width:260px; height:12px; background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15); border-radius:6px; overflow:hidden; }
.upgrade-progress-bar { position:absolute; top:0; left:0; bottom:0; width:var(--progress,0%); background:linear-gradient(90deg,#00fff2,#ff00ff 85%); box-shadow:0 0 12px #00fff2; }
.upgrade-progress-text { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:.6rem; font-weight:600; letter-spacing:.08em; color:#fff; text-shadow:0 0 6px #000; mix-blend-mode:screen; }

.upgrade-footer { display:flex; justify-content:space-between; align-items:center; padding-top:8px; border-top:1px solid rgba(255,255,255,0.08); font-size:.6rem; letter-spacing:.1em; text-transform:uppercase; opacity:.7; }
.legend { display:flex; gap:8px; flex-wrap:wrap; }

@media (max-width: 860px) {
  .upgrade-panel.ui-panel { padding:22px 16px 18px; }
  .upgrade-options-grid { grid-template-columns:1fr; }
  .upgrade-card { padding:14px 14px 16px 50px; }
  .upgrade-icon { width:50px; }
  .upgrade-title { font-size:.95rem; }
  .upgrade-desc { font-size:.7rem; }
}

/* --- Responsive Adjustments for AAA Feel --- */
@media (max-width: 1600px) {
  .character-select-content {
    gap: 20px;
  }
  .character-grid {
    min-width: 500px;
    max-width: 700px;
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    gap: 10px;
    padding: 14px 10px;
  }
  .character-box {
    min-width: 80px;
    min-height: 50px;
    font-size: 0.8em;
    padding: 8px 4px;
  }
  .character-info-box {
    min-width: 250px;
    max-width: 350px;
    padding: 15px 20px;
    font-size: 0.9em;
  }
  .menu-title {
    font-size: 2.2em;
    margin-bottom: 15px;
  }
  .character-select-actions {
    gap: 10px;
    margin-top: 20px;
  }
  .menu-button {
    font-size: 1.2em;
    padding: 8px 20px;
    min-width: 120px;
    max-width: 200px;
  }
}

@media (max-width: 1200px) {
  .character-select-content {
    flex-direction: column; /* Stack vertically on smaller screens */
    align-items: center;
    gap: 15px;
  }
  .character-grid-and-buttons {
    max-width: 100%;
  }
  .character-grid {
    min-width: 90vw;
    max-width: 90vw;
    grid-template-columns: repeat(2, 1fr); /* 2 columns on very small screens */
    grid-template-rows: repeat(6, 1fr);
    gap: 8px;
    padding: 8px 1px;
  }
  .character-info-box {
    min-width: 80vw;
    max-width: 90vw;
    min-height: 100px;
    padding: 12px 6px;
    font-size: 0.8em;
  }
  .character-select-actions {
    flex-direction: column;
    gap: 8px;
  }
  .menu-button {
    width: 100%;
    max-width: 200px;
  }
}

@media (max-width: 768px) {
  .menu-title {
    font-size: 1.8em;
    margin-bottom: 10px;
  }
  .character-grid {
    grid-template-columns: repeat(1, 1fr); /* Single column on tiny screens */
    grid-template-rows: repeat(12, 1fr);
    gap: 6px;
    padding: 6px 1px;
  }
  .character-box {
    min-width: 80px;
    min-height: 50px;
    font-size: 0.7em;
    padding: 6px 3px;
  }
  .character-portrait {
    width: 40px;
    height: 40px;
    margin-bottom: 6px;
  }
  .character-info-box {
    min-width: 80vw;
    padding: 10px 5px;
    font-size: 0.7em;
  }
  .menu-button {
    font-size: 1em;
    padding: 6px 15px;
    min-width: 100px;
  }
}
