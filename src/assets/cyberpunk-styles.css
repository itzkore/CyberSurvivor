/* =============================
   CyberSurvivor Unified UI Skin
   - Only edit this file for UI styling *per user request*
   - Goal: Consistent panel + tab layout across all screens
   - Added: CSS variables, shared panel + tab primitives
   ============================= */
/* Design Tokens */
:root {
  --ui-font: 'Orbitron', sans-serif;
  --ui-bg: linear-gradient(135deg, #0f0820, #1a0d2e, #16213e);
  --ui-surface: rgba(0, 0, 0, 0.45);
  --ui-surface-alt: rgba(0, 0, 0, 0.6);
  --ui-border: rgba(0,255,255,0.35);
  --ui-border-strong: #00ffff;
  --ui-accent: #ff0080;
  --ui-accent-soft: rgba(255,0,128,0.15);
  --ui-gold: #FFD700;
  --ui-text-main: #00ffff;
  --ui-text-muted: rgba(255,255,255,0.65);
  --ui-radius-xs: 4px;
  --ui-radius-sm: 6px;
  --ui-radius-md: 10px;
  --ui-radius-lg: 15px;
  --ui-radius-xl: 28px;
  --ui-gap-xs: 4px;
  --ui-gap-sm: 8px;
  --ui-gap-md: 12px;
  --ui-gap-lg: 20px;
  --ui-gap-xl: 32px;
  --ui-panel-max-width: 1280px;
  --ui-transition: 0.25s cubic-bezier(.4,.14,.3,1);
  --ui-shadow-glow: 0 0 20px rgba(0,255,255,.35), 0 0 40px rgba(255,0,128,.25);
  --ui-scrollbar-track: rgba(255,255,255,0.06);
  --ui-scrollbar-thumb: rgba(0,255,255,0.4);
}

/* === Global base layout (moved from inline <style> blocks to satisfy stricter CSP) === */
body { margin:0; overflow:hidden; font-family: var(--ui-font, 'Orbitron', sans-serif); padding:0; }
canvas { display:block; position:absolute; top:0; left:0; z-index:0; }
#gameCanvas.game-canvas-root { position:fixed; inset:0; margin:0; padding:0; width:100vw; height:100vh; z-index:-1; display:block; }
#main-menu { z-index:1; }
/* Adaptive scaling wrappers (logical coordinate space) */
.main-menu-adaptive, .character-select-adaptive { position:relative; }
.main-menu-adaptive[data-scale], .character-select-adaptive[data-scale] { will-change: transform; }
.main-menu-adaptive[data-scale]::after, .character-select-adaptive[data-scale]::after { content:''; position:absolute; inset:0; pointer-events:none; }
/* Orbitron variable font (TTF) self-hosted.
  NOTE: A woff2 version could be added at /assets/fonts/Orbitron/Orbitron-VariableFont_wght.woff2 for ~30-40% smaller transfer.
  When added, reintroduce a <link rel="preload" as="font"> in index.html referencing it. */
@font-face {
  font-family: 'Orbitron';
  /* Use a single stable public path to avoid noisy 404s */
  src: local('Orbitron Variable'), local('Orbitron'),
       url('/assets/fonts/Orbitron/Orbitron-VariableFont_wght.ttf') format('truetype');
  font-weight: 100 900;
  font-display: swap;
  font-style: normal;
}
@font-face { font-family: 'Orbitron'; src: local('Orbitron SemiBold'), url('/assets/fonts/Orbitron/static/Orbitron-SemiBold.ttf') format('truetype'); font-weight: 600; font-style: normal; font-display: swap; }
@font-face { font-family: 'Orbitron'; src: local('Orbitron Bold'), url('/assets/fonts/Orbitron/static/Orbitron-Bold.ttf') format('truetype'); font-weight: 700; font-style: normal; font-display: swap; }
@font-face { font-family: 'Orbitron'; src: local('Orbitron ExtraBold'), url('/assets/fonts/Orbitron/static/Orbitron-ExtraBold.ttf') format('truetype'); font-weight: 800; font-style: normal; font-display: swap; }
@font-face { font-family: 'Orbitron'; src: local('Orbitron Black'), url('/assets/fonts/Orbitron/static/Orbitron-Black.ttf') format('truetype'); font-weight: 900; font-style: normal; font-display: swap; }
html, body { font-family: 'Orbitron', sans-serif; }
.character-desc { color: rgba(255,255,255,0.8); margin-top:12px; width:100%; text-align:left; }
.character-special { width:100%; text-align:left; }
.loading-status { font-size:14px; margin-bottom:12px; opacity:0.85; }
.loading-bar-shell { width:380px; max-width:80%; height:14px; border:2px solid #0ff; box-shadow:0 0 10px #0ff inset,0 0 10px #0ff; position:relative; border-radius:8px; overflow:hidden; }
.loading-bar-fill { position:absolute; left:0; top:0; height:100%; width:0; background:linear-gradient(90deg,#00ffff,#00aaff,#00ffff); box-shadow:0 0 12px #00ffff; transition:width .18s ease-out; }
.loading-tip { margin-top:14px; font-size:11px; color:#7dd; opacity:0.7; }
*::-webkit-scrollbar-thumb { background: var(--ui-scrollbar-thumb); border-radius: 6px; }
*::-webkit-scrollbar-thumb:hover { background: rgba(0,255,255,0.65); }
/* Unified Tabs */
.ui-tabs { display: flex; gap: 0; border-bottom: 2px solid var(--ui-border); flex-shrink: 0; }
.ui-tab {
  flex: 1 1 0;
  background: var(--ui-surface-alt);
  color: var(--ui-text-muted);
  font: 600 0.9rem/1 var(--ui-font);
  letter-spacing: 1px;
  text-transform: uppercase;
  padding: 14px 16px;
  border: none;
  cursor: pointer;
  position: relative;
  transition: var(--ui-transition);
  display: flex; align-items: center; justify-content: center;
}
.ui-tab:hover { background: rgba(0,255,255,0.12); color: var(--ui-text-main); }
.ui-tab.active { background: rgba(0,255,255,0.22); color: var(--ui-text-main); }
.ui-tab.active::after { content: ''; position: absolute; left: 0; bottom: 0; width: 100%; height: 3px; background: var(--ui-accent); box-shadow:0 0 12px var(--ui-accent); }
.ui-tab-panels { position: relative; flex: 1 1 auto; display: flex; flex-direction: column; min-height: 0; }
.ui-tab-panel { flex: 1 1 auto; display: none; flex-direction: column; gap: var(--ui-gap-lg); overflow-y: auto; padding: var(--ui-gap-lg) var(--ui-gap-md); animation: fadeIn 0.4s ease; }
.ui-tab-panel.active { display: flex; }
/* Slightly tighter default text rhythm */
.ui-tab-panel { line-height: 1.35; }

/* Compact text utility (apply class to any container) */
.compact-text, .compact-text p, .compact-text li { line-height: 1.18; margin-bottom: .4em; }
.compact-text h1, .compact-text h2, .compact-text h3 { line-height:1.12; margin: .55em 0 .35em; }
.compact-text .stat-box { padding: 8px; }

/* Density utilities */
.gap-xs{gap:var(--ui-gap-xs);} .gap-sm{gap:var(--ui-gap-sm);} .gap-md{gap:var(--ui-gap-md);} .gap-lg{gap:var(--ui-gap-lg);} .gap-xl{gap:var(--ui-gap-xl);}

/* Harmonised character select panel (removed earlier duplicate definition, merged styles with later full-screen variant) */
.character-select-panel {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  font-family: var(--ui-font);
  color: var(--ui-text-main);
  background: var(--ui-bg);
  overflow: hidden;
  z-index: 1500; /* use highest of the two previous values */
  box-sizing: border-box;
}

/* =============================
  Pause Overlay (migrated from inline for CSP + global font)
  ============================= */
#pause-overlay { position:fixed; inset:0; width:100%; height:100%; background:rgba(0,0,0,0.78); display:none; z-index:1700; backdrop-filter:blur(2px); pointer-events:auto; user-select:none; font-family:'Orbitron',sans-serif; color:#b3f5e6; text-shadow:0 0 6px #00ffaa44; }
#pause-overlay.active { display:block; }
.pause-overlay-content { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; max-width:720px; padding:48px 56px; border:1px solid #00b3a3; box-shadow:0 0 28px #00ffdd33, inset 0 0 28px #00ffdd11; border-radius:14px; background:linear-gradient(145deg,rgba(0,25,28,0.35),rgba(0,12,14,0.55)); backdrop-filter:blur(4px); }
.pause-title { margin:0 0 12px; font-size:56px; letter-spacing:6px; font-weight:600; }
.pause-reason { margin:0 0 22px; font-size:18px; opacity:.78; min-height:22px; }
.pause-btn-row { display:flex; justify-content:center; gap:22px; margin:0 0 26px; flex-wrap:wrap; }
.pause-btn { background:rgba(0,180,165,0.12); color:#bff; font-size:16px; letter-spacing:1px; padding:14px 34px; border:1px solid #00b3a3; border-radius:8px; cursor:pointer; font-family:'Orbitron',sans-serif; position:relative; overflow:hidden; transition:background .18s, transform .18s, box-shadow .18s; }
.pause-btn:before { content:''; position:absolute; inset:0; background:linear-gradient(100deg,rgba(0,255,230,0.25),rgba(0,140,120,0) 60%); opacity:0; transition:opacity .25s; }
.pause-btn:hover:before { opacity:1; }
.pause-btn:hover { background:rgba(0,210,195,0.18); box-shadow:0 0 12px #00ffe533, 0 0 2px #00ffe5 inset; transform:translateY(-2px); }
.pause-btn:active { transform:translateY(0); filter:brightness(.9); }
.pause-audio { margin:0 0 28px; padding:18px 22px 24px; border:1px solid #00b3a3; border-radius:12px; background:linear-gradient(135deg,rgba(0,40,44,0.25),rgba(0,18,20,0.35)); box-shadow:0 0 18px #00ffe511 inset, 0 0 14px #00ffe522; max-width:520px; margin-left:auto; margin-right:auto; }
.pause-audio-title { font-size:18px; letter-spacing:4px; margin:0 0 14px; font-weight:600; color:#bff; text-shadow:0 0 8px #00ffe5; }
.pause-audio-row { display:flex; align-items:center; gap:14px; }
.pause-audio-label { font-size:14px; letter-spacing:2px; color:#bff; }
.pause-audio-val { font-size:13px; min-width:42px; text-align:right; letter-spacing:1px; color:#bff; }
#pause-overlay input[type=range] { appearance:none; -webkit-appearance:none; width:260px; height:6px; background:rgba(0,255,230,0.15); border-radius:4px; outline:none; border:1px solid #00b3a3; box-shadow:0 0 6px #00ffe522 inset; }
#pause-overlay input[type=range]::-webkit-slider-thumb { -webkit-appearance:none; width:18px; height:18px; border-radius:50%; background:#00ffe5; border:2px solid #014a44; box-shadow:0 0 10px #00ffe5aa, 0 0 2px #fff inset; cursor:pointer; transition:transform .15s, box-shadow .15s; }
#pause-overlay input[type=range]::-webkit-slider-thumb:hover { transform:scale(1.15); box-shadow:0 0 14px #00ffe5ff, 0 0 2px #fff inset; }
#pause-overlay input[type=range]::-moz-range-track { height:6px; background:rgba(0,255,230,0.15); border:1px solid #00b3a3; border-radius:4px; }
#pause-overlay input[type=range]::-moz-range-thumb { width:18px; height:18px; border-radius:50%; background:#00ffe5; border:2px solid #014a44; box-shadow:0 0 10px #00ffe5aa, 0 0 2px #fff inset; cursor:pointer; }
.pause-hint { margin:0; font-size:13px; opacity:.42; }

/* =============================
  Game Over Overlay (migrated from inline TS for CSP compliance)
  ============================= */
#gameover-overlay { position:fixed; inset:0; display:none; z-index:1800; background:radial-gradient(circle at 50% 40%, rgba(10,30,45,0.92) 0%, rgba(5,10,18,0.92) 55%, rgba(4,8,14,0.95) 100%); backdrop-filter:blur(4px); font-family:'Orbitron',Consolas,monospace; color:#dff; user-select:none; animation: go-fade .5s ease forwards; }
#gameover-overlay.visible { display:block; }
#gameover-overlay .go-container { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%) scale(1); width:min(100%,880px); padding:70px 80px 60px; border:1px solid #00ffe0; border-radius:18px; background:linear-gradient(145deg,rgba(0,40,55,0.55),rgba(0,18,28,0.85)); box-shadow:0 0 32px #00ffe022, inset 0 0 40px #00ffe010; text-align:center; animation: go-container-in .55s cubic-bezier(.16,.7,.3,1); }
.go-title { margin:0 0 12px; font-size:78px; letter-spacing:10px; font-weight:700; background:linear-gradient(120deg,#00fff2,#74fffd,#ff4df2); -webkit-background-clip:text; background-clip:text; color:transparent; filter:drop-shadow(0 0 12px #00fff2); }
.go-sub { font-size:18px; opacity:.68; margin-bottom:34px; letter-spacing:2px; }
.go-stats { display:flex; flex-wrap:wrap; justify-content:center; gap:26px 40px; margin:0 0 44px; font-size:14px; letter-spacing:1px; }
.go-stat { min-width:120px; }
.go-stat .label { display:block; font-size:11px; opacity:.55; letter-spacing:.15em; text-transform:uppercase; margin-bottom:4px; }
.go-stat .value { font-size:22px; font-weight:600; color:#fff; text-shadow:0 0 8px #00fff2; }
.go-buttons { display:flex; flex-wrap:wrap; gap:20px; justify-content:center; margin-bottom:34px; }
.go-btn { background:linear-gradient(140deg,#042f37,#06444e); border:1px solid #00ffe0; color:#cfffff; font-size:17px; font-weight:600; padding:16px 42px; border-radius:12px; cursor:pointer; letter-spacing:2px; position:relative; overflow:hidden; transition:background .25s, transform .2s, box-shadow .25s; font-family:'Orbitron',sans-serif; }
.go-btn:before { content:''; position:absolute; inset:0; background:linear-gradient(110deg,rgba(0,255,230,0.35),rgba(0,140,120,0) 60%); opacity:0; transition:opacity .35s; }
.go-btn:hover:before { opacity:1; }
.go-btn:hover { transform:translateY(-3px); box-shadow:0 0 18px #00ffe044, 0 0 2px #00ffe0 inset; }
.go-btn:active { transform:translateY(-1px); filter:brightness(.9); }
.go-hint { font-size:12px; opacity:.45; letter-spacing:.3em; }
.go-death-flash { position:absolute; inset:0; background:#fff; opacity:0; pointer-events:none; animation:none; }
@media (max-width:960px){ #gameover-overlay .go-container { padding:60px 40px 54px; } .go-title{ font-size:60px; letter-spacing:6px; } }
@media (max-width:640px){ #gameover-overlay .go-container { padding:50px 28px 48px; } .go-title{ font-size:48px; } .go-buttons{ gap:14px; } .go-btn{ padding:14px 32px; font-size:15px; } }
@keyframes go-fade { from { opacity:0; } to { opacity:1; } }
@keyframes go-container-in { 0% { opacity:0; transform:translate(-50%,-50%) scale(1.08); filter:blur(4px); } 60% { filter:blur(0); } 100% { opacity:1; transform:translate(-50%,-50%) scale(1); } }
@keyframes death-flash { 0% { opacity:1; } 100% { opacity:0; } }


.character-select-content {
  display: flex;
  flex-direction: row;
  align-items: stretch; /* Stretch items to fill height */
  justify-content: center;
  gap: 30px; /* Smaller gap for better spacing */
  width: 100%;
  max-width: 1200px; /* Smaller max-width for wider screens */
  flex-wrap: wrap; /* Allow content to wrap on smaller screens */
  z-index: 2; /* Ensure content is above panel background */
}

.character-grid-and-buttons {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  gap: 20px; /* Smaller gap between grid and buttons */
  flex-grow: 1; /* Allow this section to grow */
  max-width: 900px; /* Smaller max width for the grid and buttons section */
  z-index: 2;
}

.menu-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 2.5em; /* Smaller title */
  color: #5EEBFF;
  text-shadow: 0 0 20px #00FFFF, 0 0 28px #00B3FF; /* Cyan glow */
  margin: 0 0 20px 0; /* Less space below title */
  text-align: center;
  width: 100%;
  letter-spacing: 0.08em; /* Slightly smaller letter spacing */
  z-index: 2;
}

.character-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr); /* Explicitly 6 columns */
  grid-template-rows: repeat(2, 1fr); /* Explicitly 2 rows */
  gap: 16px; /* Smaller gap for grid items */
  background: rgba(10, 20, 30, 0.4); /* More transparent background */
  backdrop-filter: blur(8px); /* Frosted glass effect */
  border-radius: 18px;
  box-shadow: 0 0 28px #00FFFF66, 0 0 56px #00B3FF33; /* Cyan-only shadow */
  padding: 20px 16px;
  min-width: 720px; /* Smaller min-width for 6 columns */
  max-width: 900px;
  justify-items: center;
  align-items: center;
  margin: 0 auto;
  z-index: 2;
}

.character-grid-second-row {
  display: none; /* This is no longer needed with explicit 2x6 grid */
}

.character-box {
  background: linear-gradient(135deg, #0b1b28 0%, #102538 100%); /* Match main menu surfaces */
  border: 3px solid #00FFE0; /* Cyan border */
  border-radius: 20px;
  box-shadow: 0 0 28px #00FFFF66, 0 0 60px #00B3FF33; /* Cyan glow */
  color: #E8F8FF;
  font-family: 'Orbitron', sans-serif;
  font-size: 1em; /* Smaller font */
  padding: 10px 5px;
  min-width: 100px;
  min-height: 70px;
  text-align: center;
  cursor: pointer;
  transition: box-shadow 0.2s, transform 0.2s, border-color 0.2s; /* Faster transition */
  user-select: none;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 2;
}
.character-box.selected {
  border: 3px solid #00FFFF; /* Cyan selected border */
  box-shadow: 0 0 30px #00FFFF, 0 0 60px #00B3FF; /* Cyan selected shadow */
  transform: scale(1.08); /* Less pronounced scale */
}
.character-box:hover {
  border-color: #00FFFF;
  box-shadow: 0 0 30px #00FFFF, 0 0 60px #00B3FF;
  transform: scale(1.05);
}
.character-portrait {
  width: 60px; /* Smaller portrait for details panel */
  height: 60px;
  border-radius: 12px;
  margin-bottom: 10px;
  box-shadow: 0 0 14px #00FFFFBB, 0 0 28px #FF00FF77; /* Smaller shadow */
  background: #282828;
  object-fit: cover;
  align-self: center;
  z-index: 2;
}

.character-info-box {
  background: rgba(10,22,30,0.9); /* Slightly cooler cyan tint */
  backdrop-filter: blur(12px); /* Stronger frosted glass */
  border-radius: 28px;
  box-shadow: 0 0 56px #00FFFF44, 0 0 112px #00B3FF22;
  padding: 40px 50px;
  color: #FFFFFF;
  font-family: 'Orbitron', sans-serif;
  font-size: 1.1em; /* Smaller font */
  letter-spacing: 0.03em;
  min-width: 300px;
  max-width: 400px;
  min-height: 200px;
  margin: 0;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: flex-start;
  position: relative;
  align-self: stretch;
  z-index: 2;
}
.character-info-box h2 {
  color: #5EEBFF;
  font-size: 1.8em; /* Smaller heading */
  margin-bottom: 10px;
  text-shadow: 0 0 10px #00B3FF, 0 0 20px #00FFFF; /* Cyan glow */
}
.character-info-box p {
  color: #E0E0FF;
  font-size: 1em;
  margin-bottom: 6px;
}
.character-info-box .stat {
  color: #9ADFFF;
  font-size: 1em;
  margin-bottom: 4px;
}
.character-info-box .traits {
  margin-top: 12px;
  color: #b8faff;
  font-size: 0.9em;
}
.character-info-box .weapon {
  margin-top: 12px;
  color: #5EEBFF;
  font-size: 0.9em;
}

.character-select-actions {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  gap: 16px;
  width: 100%;
  margin-top: 30px;
  z-index: 2;
}

.menu-button {
  font-size: 1.5em;
  margin: 0;
  padding: 10px 25px;
  border-radius: 10px;
  background: linear-gradient(140deg,#083c45,#066176);
  color: #E6FEFF;
  border: none;
  box-shadow: 0 0 14px #00FFFF55, 0 0 30px #00B3FF44;
  cursor: pointer;
  transition: background 0.2s, box-shadow 0.2s, transform 0.2s;
  font-family: 'Orbitron', sans-serif;
  display: inline-block;
  width: auto;
  min-width: 150px;
  max-width: 250px;
  box-sizing: border-box;
  vertical-align: middle;
  z-index: 2;
}
.menu-button:hover {
  background: linear-gradient(140deg,#094a55,#07748c);
  box-shadow: 0 0 30px #00FFFF77, 0 0 60px #00B3FF66;
  transform: scale(1.05);
}

/* ===== Weapon Tips & Weapon Info (Character Select consistency) ===== */
.weapon-info {
  background: rgba(12, 18, 30, 0.55);
  border: 1px solid rgba(0, 255, 255, 0.25);
  border-radius: 14px;
  padding: 12px 14px;
  box-shadow: 0 0 18px #00ffff22, inset 0 0 10px #ff00ff11;
}
.weapon-info .weapon-name {
  font-family: 'Orbitron', sans-serif;
  font-size: 1.1em;
  color: #5EEBFF;
  text-shadow: 0 0 10px #00FFFF88, 0 0 14px #00B3FF55;
  margin-bottom: 6px;
}
.weapon-info .weapon-description {
  color: #D8E6FF;
  font-size: 0.95em;
  line-height: 1.3;
  margin-bottom: 8px;
}
.weapon-info .weapon-core-stats {
  display: grid;
  grid-template-columns: repeat(6, auto);
  gap: 8px 12px;
  margin: 8px 0 6px;
}
.weapon-info .weapon-core-stat {
  display: flex;
  gap: 6px;
  align-items: baseline;
  background: rgba(0, 255, 255, 0.06);
  border: 1px solid rgba(0, 255, 255, 0.15);
  padding: 4px 6px;
  border-radius: 6px;
}
.weapon-info .weapon-core-stat .w-label { color: #66F2FF; font-size: 0.85em; }
.weapon-info .weapon-core-stat .w-val { color: #E8F8FF; font-weight: 600; font-size: 0.95em; }

.weapon-traits {
  display: flex;
  flex-wrap: wrap;
  gap: 6px 8px;
  margin: 6px 0 8px;
  padding: 0;
  list-style: none;
}
.weapon-traits li {
  background: linear-gradient(135deg, rgba(0,255,255,0.12) 0%, rgba(0,179,255,0.12) 100%);
  border: 1px solid rgba(0, 255, 255, 0.25);
  color: #b8faff;
  padding: 3px 8px;
  border-radius: 8px;
  font-size: 0.8em;
  text-shadow: 0 0 8px #00ffff33, 0 0 10px #00b3ff22;
}

.weapon-tips {
  margin: 8px 0 10px;
  background: rgba(0, 255, 255, 0.06);
  border: 1px dashed rgba(0, 255, 255, 0.35);
  border-radius: 10px;
  padding: 8px 10px;
  box-shadow: inset 0 0 12px #00ffff11;
}
.weapon-tips .tips-title {
  font-family: 'Orbitron', sans-serif;
  color: #9adfff;
  font-size: 0.95em;
  letter-spacing: 0.04em;
  margin-bottom: 4px;
  text-shadow: 0 0 10px #00CFFF77;
}
.weapon-tips ul {
  margin: 0;
  padding-left: 18px;
  color: #E3F6FF;
}
.weapon-tips li {
  margin: 3px 0;
  line-height: 1.2;
}

.weapon-lore {
  margin-top: 8px;
  color: #9DE0FF;
  font-style: italic;
  text-shadow: 0 0 6px #00ffff33;
}

/* ===== CYBERPUNK MAIN MENU ===== */
.cyberpunk-main-menu {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #0f0820, #1a0d2e, #16213e);
  display: flex;
  flex-direction: column;
  z-index: 1000;
  font-family: 'Orbitron', monospace;
  color: #00ffff;
  overflow: hidden;
}
/* === New Unified Main Menu Layout (2025 refresh) === */
.main-menu-shell { position:relative; display:flex; flex-direction:column; height:100vh; width:100%; padding:32px 46px 30px; box-sizing:border-box; }
.mm-header { display:flex; align-items:center; justify-content:space-between; gap:32px; margin-bottom:30px; }
.logo-block { display:flex; flex-direction:column; gap:6px; }
.logo-main { font-size:48px; font-weight:800; letter-spacing:6px; background:linear-gradient(120deg,#00ffe5,#00b3ff,#ff33cc); -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow:0 0 12px #00fefa,0 0 22px #ff32cc33; -webkit-font-smoothing:antialiased; font-smooth:always; }
.logo-main span { filter:drop-shadow(0 0 10px #ff33cc); }
.version-tag { font-size:11px; letter-spacing:3px; color:#7df; opacity:.6; }
.profile-block { display:flex; align-items:center; gap:20px; }
.currency-display.compact { background:rgba(0,255,255,0.08); padding:8px 14px; border:1px solid #00ffe5; border-radius:10px; font-size:15px; display:flex; align-items:center; gap:6px; box-shadow:0 0 12px #00ffe522 inset; }
.currency-display.compact .currency-icon { filter:drop-shadow(0 0 6px #0ff); }
.auth-container { position:relative; display:flex; align-items:center; }
.auth-profile { background:rgba(0,255,255,0.08); border:1px solid #00ffe5; border-radius:14px; display:inline-flex; align-items:center; gap:12px; padding:6px 12px 6px 6px; cursor:pointer; box-shadow:0 0 16px #00ffe522 inset,0 0 12px #00ffe522; transition:background .25s; }
.auth-profile:hover { background:rgba(0,255,255,0.16); }
.auth-avatar { width:42px; height:42px; border-radius:50%; object-fit:cover; border:2px solid #00ffe5; box-shadow:0 0 10px #00ffe5; }
.auth-meta { display:flex; flex-direction:column; line-height:1.1; }
.auth-nick { font-size:14px; font-weight:600; letter-spacing:1px; color:#fff; text-shadow:0 0 6px #00fff2; max-width:160px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.auth-email { font-size:10px; letter-spacing:1px; opacity:.55; max-width:160px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.mini-logout { background:none; border:none; color:#ff4d9e; font-size:16px; cursor:pointer; padding:4px 6px; border-radius:6px; transition:background .25s, transform .2s; }
.mini-logout:hover { background:rgba(255,0,128,0.15); transform:scale(1.05); }

.mm-main { flex:1 1 auto; display:grid; grid-template-columns:340px 1fr 380px; gap:38px; position:relative; }
@media (max-width:1450px){ .mm-main { grid-template-columns:300px 1fr 340px; gap:28px; }}
@media (max-width:1200px){ .mm-main { grid-template-columns:320px 1fr; grid-template-rows:auto 340px; }
  .highscores-panel { grid-column:1 / span 2; }
}
@media (max-width:880px){ .mm-main { display:flex; flex-direction:column; }
  .panel { min-height:0; }
}

.panel { position:relative; background:rgba(0,25,35,0.55); border:1px solid #00ffe0; border-radius:20px; padding:28px 26px 30px; box-shadow:0 0 22px #00ffe022, inset 0 0 26px #00ffe00f; backdrop-filter:blur(10px); display:flex; flex-direction:column; overflow:hidden; }
.panel:before { content:''; position:absolute; inset:0; background:radial-gradient(circle at 30% 10%,rgba(0,255,255,0.08),rgba(0,0,0,0)); pointer-events:none; }
.panel.left { gap:26px; }
.panel.center { align-items:center; justify-content:center; }
.panel.right { overflow:hidden; }

/* Nav Panel */
.main-cta { background:linear-gradient(140deg,#083c45,#066176); border:1px solid #00ffe0; color:#dff; font:700 20px/1 'Orbitron'; letter-spacing:3px; padding:18px 26px; border-radius:14px; cursor:pointer; position:relative; overflow:hidden; text-shadow:0 0 8px #00ffe5; transition:background .3s, transform .25s, box-shadow .3s; display:inline-flex; align-items:center; justify-content:center; min-height:52px; line-height:1; }
.main-cta:before { content:''; position:absolute; inset:0; background:linear-gradient(100deg,rgba(0,255,255,0.35),rgba(0,140,120,0) 60%); opacity:0; transition:opacity .35s; }
.main-cta:hover:before { opacity:1; }
.main-cta:hover { transform:translateY(-3px); box-shadow:0 0 20px #00ffe033,0 0 2px #00ffe0 inset; }
.main-cta:active { transform:translateY(-1px); }

/* Cyberpunk glitch click effect */
.main-cta.glitch { animation: btn-jitter .65s steps(10, end); text-shadow: -2px 0 #ff40ff, 2px 0 #40ffff; filter: brightness(1.15) saturate(1.2); }
.main-cta.glitch::after { content:''; position:absolute; inset:-2px; pointer-events:none; background: repeating-linear-gradient(0deg, rgba(255,255,255,0.08) 0, rgba(255,255,255,0.08) 1px, transparent 1px, transparent 3px); mix-blend-mode: overlay; animation: scan-move .65s linear; }
@keyframes btn-jitter { 
  0% { transform:none; }
  10% { transform: translate(-1px, 1px) skewX(-2deg); }
  20% { transform: translate(2px, -1px) skewX(2deg); }
  30% { transform: translate(-1px, 0) skewY(1deg); }
  40% { transform: translate(1px, 1px) skewX(-1deg); }
  50% { transform: translate(-2px, -1px) skewY(-1deg); }
  60% { transform: translate(1px, 0) skewX(1deg); }
  70% { transform: translate(-1px, 1px) skewY(1deg); }
  80% { transform: translate(0, -1px) skewX(-1deg); }
  90% { transform: translate(1px, 0) skewY(-1deg); }
  100% { transform:none; }
}
@keyframes scan-move { from { background-position:0 0; } to { background-position:0 12px; } }

/* Reduce-motion safety for glitch animation */
@media (prefers-reduced-motion: reduce) {
  .main-cta.glitch { animation: none; text-shadow: none; filter: none; }
  .main-cta.glitch::after { display: none; }
}

.mode-select-block { display:flex; flex-direction:column; gap:10px; }
.mode-select-block label { font-size:12px; letter-spacing:3px; opacity:.65; }
.mode-select { background:rgba(0,255,255,0.08); border:1px solid #00ffe5; padding:10px 12px; border-radius:10px; color:#bff; font-family:'Orbitron'; letter-spacing:1px; outline:none; cursor:pointer; }
.mode-select:focus { box-shadow:0 0 0 2px #ff33cc88,0 0 12px #00ffe5; }
.mode-desc { font-size:11px; opacity:.55; line-height:1.3; }

.nav-buttons { display:flex; flex-direction:column; gap:14px; }
.nav-btn { background:rgba(0,255,255,0.08); border:1px solid #00ffe0; color:#dff; padding:12px 18px; border-radius:12px; font:600 14px/1 'Orbitron'; letter-spacing:2px; cursor:pointer; position:relative; overflow:hidden; text-align:left; transition:background .25s, transform .2s, box-shadow .25s; }
.nav-btn:before { content:''; position:absolute; inset:0; background:linear-gradient(100deg,rgba(0,255,255,.28),rgba(0,140,120,0) 60%); opacity:0; transition:opacity .35s; }
.nav-btn:hover:before { opacity:1; }
.nav-btn:hover { background:rgba(0,255,255,0.16); transform:translateY(-2px); box-shadow:0 0 14px #00ffe022; }
.nav-btn:active { transform:translateY(-1px); }
.notification-dot { position:absolute; top:8px; right:10px; width:8px; height:8px; background:#ff4d9e; border-radius:50%; box-shadow:0 0 8px #ff4d9e; }

/* Character Preview */
.preview-panel { gap:20px; }
.preview-portrait { width:220px; height:220px; border:2px solid #00ffe0; border-radius:22px; overflow:hidden; position:relative; box-shadow:0 0 24px #00ffe044,0 0 60px #ff33cc22; }
.preview-portrait img { width:100%; height:100%; object-fit:contain; image-rendering:pixelated; }
.preview-meta { display:flex; flex-direction:column; align-items:center; gap:18px; }
.preview-name { font-size:28px; font-weight:700; letter-spacing:3px; text-shadow:0 0 14px #00ffe5; }
.preview-stats { display:flex; flex-direction:row; gap:26px; font-size:13px; letter-spacing:1px; }
.preview-stats .stat-item { display:flex; flex-direction:column; align-items:center; }
.preview-stats .stat-label { font-size:10px; opacity:.55; letter-spacing:.25em; margin-bottom:4px; }
.preview-stats .stat-value { font-size:20px; font-weight:600; color:#fff; text-shadow:0 0 8px #00ffe5; }

/* High Scores Panel */
.highscores-panel { display:flex; flex-direction:column; gap:18px; }
.hs-header { font-size:18px; letter-spacing:4px; font-weight:600; text-shadow:0 0 10px #00ffe5; }
.hs-content { flex:1 1 auto; overflow-y:auto; display:flex; flex-direction:column; gap:10px; padding-right:4px; }
.hs-empty { font-size:12px; opacity:.5; letter-spacing:2px; }
.hs-row { display:grid; grid-template-columns:40px 1fr 70px 60px; align-items:center; gap:10px; font-size:13px; background:rgba(0,255,255,0.06); border:1px solid rgba(0,255,255,0.25); padding:8px 10px; border-radius:10px; position:relative; overflow:hidden; }
.hs-row.first { background:rgba(255,215,0,0.12); border-color:#ffd700; box-shadow:0 0 16px #ffd70055 inset; }
.hs-row .rank { font-weight:700; font-size:16px; text-align:center; }
.hs-row .nick { font-weight:600; letter-spacing:1px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; -webkit-font-smoothing:antialiased; }
/* Crisper small table text in dynamic highscores grid */
.highscores-panel .hs-cell { -webkit-font-smoothing:antialiased; font-smooth:always; text-shadow:0 0 4px #00ffe522; }
.hs-row .score { font-weight:700; color:#fff; text-shadow:0 0 6px #00ffe5; }
.hs-row .lvl { font-size:11px; opacity:.6; }

/* Footer */
.mm-footer { display:flex; align-items:center; justify-content:space-between; margin-top:26px; font-size:11px; letter-spacing:3px; opacity:.65; }
.status-line { display:flex; align-items:center; gap:6px; }
.status-dot { display:inline-block; width:10px; height:10px; background:#00ffe5; border-radius:50%; box-shadow:0 0 8px #00ffe5; animation: pulseDot 2.8s ease-in-out infinite; }
@keyframes pulseDot { 0%,100% { transform:scale(.9); opacity:.9; } 50% { transform:scale(1.25); opacity:1; } }
.hint-line { opacity:.5; }

/* Nickname Modal */
#nickname-modal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:3000; background:rgba(0,0,0,0.72); backdrop-filter:blur(4px); }
#nickname-modal .modal-content { width:420px; max-width:90%; background:linear-gradient(140deg,rgba(0,40,55,0.85),rgba(0,18,30,0.92)); border:1px solid #00ffe0; border-radius:18px; padding:34px 40px 42px; box-shadow:0 0 32px #00ffe022, inset 0 0 30px #00ffe010; }
#nickname-modal h2 { margin:0 0 18px; font-size:28px; letter-spacing:6px; text-align:center; font-weight:700; background:linear-gradient(120deg,#00ffe5,#ff33cc); -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow:0 0 10px #00fff2; }
.nickname-body p { font-size:12px; line-height:1.4; letter-spacing:1px; opacity:.7; margin:0 0 14px; }
.nickname-input { width:100%; padding:14px 16px; font:600 16px/1 'Orbitron'; background:rgba(0,255,255,0.08); border:1px solid #00ffe0; border-radius:12px; color:#dff; outline:none; letter-spacing:2px; box-shadow:0 0 14px #00ffe522 inset; }
.nickname-input:focus { box-shadow:0 0 0 2px #ff33cc88,0 0 12px #00ffe5; }
.nickname-actions { display:flex; gap:14px; margin-top:18px; justify-content:flex-end; }
.nickname-actions .cyberpunk-btn, .nickname-actions button { flex:1 1 0; background:rgba(0,255,255,0.12); border:1px solid #00ffe5; color:#dff; padding:12px 16px; border-radius:12px; font:600 14px/1 'Orbitron'; letter-spacing:2px; cursor:pointer; position:relative; overflow:hidden; transition:background .25s, transform .2s, box-shadow .25s; }
.nickname-actions button:hover { background:rgba(0,255,255,0.22); transform:translateY(-2px); }
.nickname-actions button:active { transform:translateY(-1px); }

/* Game Over additions: highscores list styling inside overlay */
.go-highscores { flex:1 1 100%; width:100%; max-width:520px; margin:12px auto 0; display:flex; flex-direction:column; gap:6px; }
.go-highscores .hs-title { font-size:14px; letter-spacing:3px; opacity:.65; text-align:center; margin-bottom:4px; }
.go-highscores .hs-row { display:grid; grid-template-columns:36px 1fr 70px; gap:12px; align-items:center; background:rgba(0,255,255,0.06); border:1px solid rgba(0,255,255,0.3); padding:6px 10px; border-radius:10px; font-size:12px; }
.go-highscores .hs-row.first { background:rgba(255,215,0,0.16); border-color:#ffd700; }
.go-highscores .hs-row.me { outline:1px solid #ff33cc; }
.go-highscores .rank { text-align:center; font-weight:700; }
.go-highscores .nick { font-weight:600; letter-spacing:1px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.go-highscores .score { font-weight:700; color:#fff; text-shadow:0 0 6px #00ffe5; }
.new-hs-banner { margin-top:10px; font-size:13px; letter-spacing:3px; color:#ffd700; text-shadow:0 0 10px #ffd700cc; animation: pulseHS 2s infinite; }
@keyframes pulseHS { 0%,100% { opacity:.65; } 50% { opacity:1; } }

/* Auth Fallback Modal */
#auth-fallback-modal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.72); z-index:4000; backdrop-filter:blur(3px); }
#auth-fallback-modal .afm-shell { width:100%; max-width:440px; padding:20px; }
#auth-fallback-modal .afm-panel { background:linear-gradient(140deg,rgba(0,40,55,0.9),rgba(0,18,30,0.95)); border:1px solid #00ffe5; border-radius:18px; padding:34px 38px 42px; box-shadow:0 0 34px #00ffe033, inset 0 0 30px #00ffe015; font-family:'Orbitron'; color:#dff; text-align:center; }
#auth-fallback-modal h2 { margin:0 0 14px; font-size:30px; letter-spacing:6px; font-weight:700; background:linear-gradient(120deg,#00ffe5,#ff33cc); -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow:0 0 12px #00fff2; }
#auth-fallback-modal p { font-size:12px; opacity:.6; letter-spacing:1px; margin:0 0 20px; }
#auth-fallback-modal .afm-close { margin-top:26px; background:rgba(255,0,128,0.15); border:1px solid #ff33cc; color:#ffe3f5; padding:10px 20px; border-radius:10px; cursor:pointer; font:600 13px/1 'Orbitron'; letter-spacing:2px; transition:background .25s, transform .2s; }
#auth-fallback-modal .afm-close:hover { background:rgba(255,0,128,0.28); transform:translateY(-2px); }
#auth-fallback-modal .afm-close:active { transform:translateY(-1px); }

.matrix-bg-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  /* Removed magenta wash to avoid any red-tinted background perception; keep subtle cyan glows only */
  background:
    radial-gradient(circle at 25% 25%, rgba(0, 255, 255, 0.06) 0%, transparent 52%),
    radial-gradient(circle at 70% 70%, rgba(0, 180, 255, 0.05) 0%, transparent 54%);
  z-index: -1;
}

.main-menu-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 30px 50px;
  border-bottom: 2px solid rgba(0, 255, 255, 0.3);
  background: rgba(0, 0, 0, 0.3);
}

.game-logo {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

.logo-text {
  font-size: 3rem;
  font-weight: 900;
  text-shadow: 0 0 20px #00ffff, 0 0 40px #00ffff;
  letter-spacing: 8px;
  background: linear-gradient(45deg, #00ffff, #00b3ff);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}

.logo-subtext {
  font-size: 1.2rem;
  letter-spacing: 4px;
  color: rgba(255, 255, 255, 0.7);
  margin-top: -8px;
}

.currency-display {
  display: flex;
  align-items: center;
  background: rgba(0, 255, 255, 0.1);
  border: 2px solid #00ffff;
  border-radius: 25px;
  padding: 10px 20px;
  font-size: 1.5rem;
  font-weight: 700;
}

.currency-icon {
  margin-right: 10px;
  font-size: 2rem;
  animation: pulse 2s infinite;
}

.main-menu-content {
  flex: 1;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: clamp(24px,4vh,60px) clamp(32px,5vw,90px);
  gap: clamp(40px,8vw,160px);
}

.menu-navigation {
  display: flex;
  flex-direction: column;
  gap: 20px;
  min-width: 300px;
}

.cyberpunk-btn {
  position: relative;
  background: rgba(0, 0, 0, 0.8);
  border: 2px solid #00ffff;
  color: #00ffff;
  font-family: inherit;
  font-size: 1.2rem;
  font-weight: 600;
  padding: 15px 30px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 2px;
  overflow: hidden;
  min-height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cyberpunk-btn.primary-btn {
  border-color: #ff0080;
  color: #ff0080;
  background: rgba(255, 0, 128, 0.1);
}

/* Tertiary/tight auth button variant (login) ensure always clickable above decorative layers */
#login-btn { z-index: 50; }

.cyberpunk-btn:hover {
  transform: translateX(5px);
  box-shadow: 0 0 30px currentColor;
}

.cyberpunk-btn:hover .btn-glow {
  opacity: 1;
  width: 100%;
}

.btn-glow {
  position: absolute;
  top: 0;
  left: -100%;
  width: 0%;
  height: 100%;
  background: linear-gradient(90deg, transparent, currentColor, transparent);
  opacity: 0;
  transition: all 0.5s ease;
}

.notification-dot {
  position: absolute;
  top: -5px;
  right: -5px;
  width: 12px;
  height: 12px;
  background: #ff0080;
  border-radius: 50%;
  animation: pulse 1.5s infinite;
}

.menu-preview {
  flex: 1;
  max-width: 600px;
}

.selected-character-preview {
  background: rgba(0, 0, 0, 0.55);
  border: 2px solid rgba(0, 255, 255, 0.45);
  border-radius: 18px;
  padding: clamp(26px,3.2vh,48px) clamp(28px,3.5vw,54px);
  text-align: center;
  backdrop-filter: blur(8px);
  max-width: 520px;
}

.preview-title {
  font-size: 1.5rem;
  margin-bottom: 30px;
  color: rgba(255, 255, 255, 0.8);
  letter-spacing: 3px;
}

.preview-portrait {
  width: clamp(160px,18vh,240px);
  height: clamp(160px,18vh,240px);
  margin: 0 auto 30px;
  border: 3px solid #00ffff;
  border-radius: 50%;
  overflow: hidden;
  position: relative;
}

.preview-portrait img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.preview-name {
  font-size: clamp(1.4rem,2.6vw,2.2rem);
  font-weight: 700;
  margin-bottom: 20px;
  color: #00ffff;
}

.preview-stats {
  display: flex;
  justify-content: space-around;
  margin-top: 20px;
}

.stat-item {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.stat-label {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 5px;
}

.stat-value {
  font-size: clamp(1.2rem,2.2vw,1.9rem);
  font-weight: 700;
  color: #ff0080;
}

/* Stretch mode container adjustments */
#main-menu-adaptive { display:flex; flex-direction:column; box-sizing:border-box; }

@media (max-width: 1200px) {
  .main-menu-content { flex-direction: column; justify-content:flex-start; gap:48px; }
  .menu-navigation { flex-direction: row; flex-wrap: wrap; justify-content:center; }
  .menu-navigation .cyberpunk-btn { flex:1 1 240px; }
  .menu-preview { max-width: 100%; }
}

.main-menu-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 50px;
  border-top: 2px solid rgba(0, 255, 255, 0.3);
  background: rgba(0, 0, 0, 0.3);
}

.version-info {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.5);
}

.connection-status {
  display: flex;
  align-items: center;
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.7);
}

.status-dot {
  width: 8px;
  height: 8px;
  background: #00ff00;
  border-radius: 50%;
  margin-right: 10px;
  animation: pulse 2s infinite;
}

/* ===== CYBERPUNK MODALS ===== */
.cyberpunk-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
  backdrop-filter: blur(5px);
}

.modal-content {
  background: linear-gradient(135deg, #0f0820, #1a0d2e);
  border: 2px solid #00ffff;
  border-radius: 15px;
  padding: 40px;
  max-width: 90%;
  max-height: 90%;
  overflow-y: auto;
  font-family: 'Orbitron', monospace;
  color: #00ffff;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
  border-bottom: 2px solid rgba(0, 255, 255, 0.3);
  padding-bottom: 20px;
}

.modal-header h2 {
  font-size: 2rem;
  margin: 0;
  text-shadow: 0 0 10px #00ffff;
}

.close-btn {
  background: none;
  border: 2px solid #ff0080;
  color: #ff0080;
  font-size: 1.5rem;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s ease;
}

.close-btn:hover {
  background: #ff0080;
  color: white;
  box-shadow: 0 0 20px #ff0080;
}

.upgrades-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.upgrade-item {
  background: rgba(0, 0, 0, 0.4);
  border: 2px solid rgba(0, 255, 255, 0.3);
  border-radius: 10px;
  padding: 20px;
  display: flex;
  align-items: center;
  gap: 15px;
  transition: all 0.3s ease;
}

.upgrade-item:hover {
  border-color: #00ffff;
  background: rgba(0, 255, 255, 0.1);
}

.upgrade-icon {
  font-size: 2.5rem;
  width: 60px;
  text-align: center;
}

.upgrade-info {
  flex: 1;
}

/* Emphasized upgrade info rows (no decimals) */
.upgrade-info.emph { font-weight:700; letter-spacing:.2px; margin-top:6px; font-size:.9rem; }
.upgrade-info .delta { display:inline-flex; align-items:center; gap:3px; }
.upgrade-info .delta .k { opacity:.9; text-transform:uppercase; font-weight:800; letter-spacing:.3px; }
.upgrade-info .delta .v { margin-left:1px; }
.upgrade-info .delta .arrow { margin-left:2px; filter: drop-shadow(0 0 6px rgba(255,255,255,0.2)); }

.upgrade-name {
  font-size: 1.3rem;
  font-weight: 600;
  margin-bottom: 5px;
}

.upgrade-level {
  color: #ff0080;
  font-weight: 700;
  margin-bottom: 5px;
}

.upgrade-cost {
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.9rem;
}

.upgrade-btn {
  background: rgba(255, 0, 128, 0.2);
  border: 2px solid #ff0080;
  color: #ff0080;
  padding: 10px 20px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
}

.upgrade-btn:hover {
  background: #ff0080;
  color: white;
  box-shadow: 0 0 20px #ff0080;
}

.stats-content {
  margin-top: 20px;
}

.stats-content h3 {
  color: #00ffff;
  margin-bottom: 15px;
  font-size: 1.5rem;
}

.score-item {
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(0, 255, 255, 0.3);
  border-radius: 5px;
  padding: 10px 15px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
}

.no-scores {
  text-align: center;
  color: rgba(255, 255, 255, 0.5);
  padding: 40px;
  font-style: italic;
}

/* ===== CHARACTER CAROUSEL (Consolidated) ===== */
.character-select-panel { position:fixed; inset:0; width:100%; height:100%; background:var(--ui-bg); display:flex; flex-direction:column; color:var(--ui-text-main); font-family:var(--ui-font); overflow:hidden; box-sizing:border-box; z-index:1500; }
/* Character Select palette override to match main menu (cyan/teal) */
.character-select-panel {
  --ui-accent: #00ffff;
  --ui-accent-soft: rgba(0,255,255,0.15);
}
/* Use dynamic viewport height to avoid iOS / Electron quirks & force full filling */
#character-select-adaptive { box-sizing:border-box; position:relative; width:100%; height:100dvh; min-height:100%; display:flex; flex-direction:column; padding:0; gap:12px; }
.carousel-header { display:flex; flex-direction:column; gap:6px; flex-shrink:0; }
.carousel-title { font-size:46px; letter-spacing:6px; margin:0; text-shadow:0 0 18px #00ffff; font-weight:700; }
.carousel-subtitle { font-size:14px; letter-spacing:3px; opacity:.75; }
/* Core two-column container now truly fills remaining vertical space */
.carousel-container { flex:1 1 auto; display:flex; align-items:stretch; gap:clamp(32px,5vw,72px); min-height:0; width:100%; overflow:hidden; }
/* Allow main panel to grow instead of fixed width cap so wide windows are used */
.carousel-main { flex:1 1 55%; max-width:100%; display:flex; flex-direction:column; align-items:center; justify-content:space-between; min-height:0; }
.portrait-nav { display:flex; align-items:center; gap:18px; }
.portrait-nav .nav-arrow { background:#08131e; border:2px solid #0ff; color:#0ff; width:52px; height:52px; font-size:28px; line-height:1; cursor:pointer; transition:background .18s, transform .18s; display:flex; align-items:center; justify-content:center; }
.portrait-nav .nav-arrow:hover { background:#0d2536; transform:translateY(-2px); }
.character-portrait { width:260px; height:260px; border:3px solid #00ffff; border-radius:18px; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.06); box-shadow:0 0 24px #00ffff22; }
.character-portrait img { max-width:85%; image-rendering:pixelated; }
.character-name { font-size:34px; letter-spacing:4px; margin:18px 0 4px; text-shadow:0 0 12px #00ffff; }
.character-class { font-size:15px; opacity:.65; letter-spacing:3px; margin-bottom:22px; }
/* Thumbnails sit in normal document flow now so portrait area + info panel stretch better */
.carousel-thumbnails { margin-top:18px; display:flex; flex-wrap:nowrap; gap:12px; max-height:96px; overflow-x:auto; overflow-y:hidden; padding:4px 2px 8px; width:100%; justify-content:center; }
.carousel-thumbnails .thumbnail { flex:0 0 auto; }
.thumbnail { width:70px; height:70px; border:2px solid #0aa; border-radius:10px; display:flex; align-items:center; justify-content:center; background:#0a121c; cursor:pointer; transition:border-color .18s, box-shadow .18s, transform .18s; }
.thumbnail.active { border-color:#00ffff; box-shadow:0 0 10px #00ffff66; }
.thumbnail:hover { border-color:#00ffff; transform:translateY(-3px); }
/* Info panel consumes remaining width and full height with its own internal scroll */
.info-panel { flex:1 1 45%; display:flex; flex-direction:column; min-width:0; min-height:0; }
.info-tabs { display:flex; gap:10px; }
.info-tab { background:rgba(0,0,0,0.35); border:2px solid #0c3a44; color:#66cfd9; padding:12px 20px; font-weight:600; letter-spacing:2px; cursor:pointer; font-size:13px; text-transform:uppercase; }
.info-tab.active { border-color:#00ffff; color:#00ffff; background:rgba(0,255,255,0.15); }
.tab-content { flex:1 1 auto; min-height:0; overflow:auto; margin-top:16px; border:1px solid #0b3942; padding:18px 20px; background:rgba(0,0,0,0.32); border-radius:12px; }
/* Footer pinned to bottom via parent flex; gap tightened for smaller windows */
.carousel-footer { display:flex; justify-content:space-between; gap:32px; padding-top:4px; flex-shrink:0; }
.back-button, .select-button { background:rgba(0,0,0,0.4); border:2px solid #00ffff; color:#00ffff; font-weight:600; padding:16px 34px; letter-spacing:3px; cursor:pointer; font-family:var(--ui-font); font-size:14px; text-transform:uppercase; position:relative; overflow:hidden; transition:background .22s, box-shadow .22s, transform .2s; }
.back-button:hover, .select-button:hover { background:rgba(0,255,255,0.15); box-shadow:0 0 14px #00ffff55; transform:translateY(-2px); }
@media (max-height: 760px) { #character-select-adaptive { gap:20px; } .carousel-container { gap:32px; } .character-portrait { width:220px; height:220px; } .carousel-thumbnails { max-height:200px; } }
@media (max-height: 640px) { #character-select-adaptive { gap:16px; } .character-portrait { width:190px; height:190px; } .carousel-title { font-size:38px; } }

.carousel-header { padding:10px 0 8px; border-bottom:2px solid rgba(0,255,255,0.25); background:rgba(0,0,0,0.28); text-align:center; flex-shrink:0; }

.carousel-title {
  font-size: 2.5rem;
  font-weight: 900;
  text-shadow: 0 0 20px #00ffff;
  letter-spacing: 6px;
  margin-bottom: 10px;
  background: linear-gradient(45deg, #00ffff, #00b3ff);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}

.carousel-subtitle {
  color: rgba(255, 255, 255, 0.7);
  font-size: 1rem;
  letter-spacing: 2px;
}

.carousel-container { flex:1 1 auto; display:flex; position:relative; overflow:hidden; width:100%; height:100%; min-height:0; box-sizing:border-box; padding:0; gap:clamp(24px,3.5vw,56px); align-items:stretch; }

.carousel-main { flex:1 1 55%; min-width:0; display:flex; flex-direction:column; align-items:center; justify-content:space-between; padding:12px 0 4px; position:relative; box-sizing:border-box; min-height:0; }

.character-display {
  text-align:center;
  max-width:520px;
  width:100%;
  margin:0 auto;
  flex:1 1 auto; /* allow to grow and center vertically */
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-height:0;
}

.character-portrait {
  width: 280px; /* Slightly smaller */
  height: 280px;
  margin: 0 auto 20px; /* Reduced bottom margin */
  border: 3px solid #00ffff; /* Slightly thinner border */
  border-radius: 15px; /* Slightly smaller radius */
  overflow: hidden;
  position: relative;
  box-shadow: 0 0 25px rgba(0, 255, 255, 0.4); /* Subtler glow */
  transition: all 0.3s ease;
}

.character-portrait:hover {
  transform: scale(1.03); /* Smaller hover effect */
  box-shadow: 0 0 35px rgba(0, 255, 255, 0.6);
}

/* Prevent cropping of sprite; ensure full sprite visible */
.character-portrait img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  image-rendering: pixelated;
}

.character-name {
  font-size: 2.2rem; /* Slightly smaller */
  font-weight: 700;
  margin-bottom: 15px; /* Reduced margin */
  color: #00ffff;
  text-shadow: 0 0 12px #00ffff;
  letter-spacing: 2px; /* Reduced spacing */
}

.character-class {
  font-size: 1.1rem; /* Slightly smaller */
  color: #9adfff;
  text-shadow: 0 0 8px rgba(0, 207, 255, 0.35);
  margin-bottom: 20px; /* Reduced margin */
  text-transform: uppercase;
  letter-spacing: 1.5px; /* Reduced spacing */
}

.navigation-arrows {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 10;
}

.nav-arrow {
  background: rgba(0, 0, 0, 0.8);
  border: 2px solid #00ffff;
  color: #00ffff;
  font-size: 1.6rem; /* Slightly adjusted */
  width: 50px; /* Slightly smaller */
  height: 50px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.nav-arrow:hover {
  background: rgba(0, 255, 255, 0.2);
  box-shadow: 0 0 15px #00ffff; /* Smaller glow */
  transform: scale(1.05); /* Smaller scale */
}

/* Inline portrait nav container */
.portrait-nav { display:flex; align-items:center; justify-content:center; gap:20px; width:100%; max-width:560px; margin:0 auto 8px; flex-wrap:nowrap; }
.portrait-nav .character-portrait { margin:0; }

/* Remove absolute offset adjustments when inside inline layout */
.portrait-nav .nav-arrow.prev,
.portrait-nav .nav-arrow.next { position: static; left:auto !important; right:auto !important; }

/* Stabilize arrow sizing to avoid layout shift on hover */
.portrait-nav .nav-arrow { flex: 0 0 50px; will-change: transform; }
.portrait-nav .nav-arrow:hover { transform: none; box-shadow: 0 0 18px #00ffff, 0 0 28px #00b3ff; }
.portrait-nav .nav-arrow:active { transform: translateY(1px); }

/* Reduce gap & portrait size slightly on smaller widths for stability */
@media (max-width: 900px) {
  .portrait-nav { gap: 14px; }
  .portrait-nav .nav-arrow { width:46px; height:46px; font-size:1.4rem; }
  .portrait-nav .character-portrait { width:240px; height:240px; }
}
@media (max-width: 600px) {
  .portrait-nav { gap: 10px; }
  .portrait-nav .nav-arrow { width:42px; height:42px; font-size:1.3rem; }
  .portrait-nav .character-portrait { width:200px; height:200px; }
}

/* (Deprecated absolute layout for thumbnails removed; now handled above) */

.thumbnail {
  width: 70px; /* Smaller thumbnails */
  height: 70px;
  border: 2px solid rgba(0, 255, 255, 0.3);
  border-radius: 8px; /* Smaller radius */
  overflow: hidden;
  cursor: pointer;
  transition: all 0.3s ease;
  opacity: 0.6;
  flex-shrink: 0; /* Prevent shrinking */
}

.thumbnail:hover {
  border-color: #00ffff;
  transform: scale(1.03); /* Smaller hover effect */
  opacity: 0.8;
}

.thumbnail.active {
  border-color: #00ffff;
  box-shadow: 0 0 12px #00ffff; /* Smaller glow */
  opacity: 1;
  transform: scale(1.06); /* Smaller active scale */
}

.thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.info-panel {
  flex:1 1 45%;
  min-width:0;
  min-height:0;
  background:rgba(0,0,0,0.4);
  border-left:2px solid rgba(0,255,255,0.3);
  overflow:hidden; /* internal scroll in tab-content */
  backdrop-filter:blur(10px);
  display:flex;
  flex-direction:column;
  box-sizing:border-box;
  padding:12px 12px 8px;
}

.info-tabs {
  display: flex;
  border-bottom: 2px solid rgba(0, 255, 255, 0.3);
  flex-shrink: 0; /* Prevent tabs from shrinking */
}

.info-tab {
  flex: 1;
  background: rgba(0, 0, 0, 0.6);
  border: none;
  color: rgba(255, 255, 255, 0.7);
  font-family: inherit;
  font-size: 0.9rem; /* Slightly smaller */
  font-weight: 600;
  padding: 15px; /* Reduced padding */
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.info-tab:hover {
  background: rgba(0, 255, 255, 0.1);
  color: #00ffff;
}

.info-tab.active {
  background: rgba(0, 255, 255, 0.2);
  color: #00ffff;
  border-bottom: 3px solid #00ffff;
}

.tab-content {
  padding:16px 18px;
  line-height:1.35;
  flex:1 1 auto;
  display:flex;
  flex-direction:column;
  align-items:stretch;
  overflow:auto;
  min-height:0; /* allow flex shrink */
}

.tab-content > * {
  align-self: stretch; /* Force all children to take full width */
  text-align: left; /* Align text to left instead of center */
}

.tab-content h3 {
  color: #00ffff;
  margin-bottom: 15px; /* Reduced margin */
  font-size: 1.3rem; /* Slightly smaller */
  text-shadow: 0 0 8px #00ffff;
  flex-shrink: 0; /* Prevent title from shrinking */
  text-align: left; /* Force left alignment */
  width: 100%;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px; /* Reduced gap */
  margin-bottom: 20px; /* Reduced margin */
  flex-shrink: 0; /* Prevent grid from shrinking */
  width: 100%; /* Full width */
  justify-self: stretch; /* Stretch to container width */
  align-self: stretch; /* Stretch to container width */
  box-sizing: border-box; /* Include padding in width calculation */
}
.stats-grid.cols-3 { grid-template-columns: repeat(3, 1fr); }

.stat-box {
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(0, 255, 255, 0.3);
  border-radius: 6px; /* Smaller radius */
  padding: 12px; /* Reduced padding */
  text-align: center;
  min-height: 60px; /* Ensure consistent height */
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.stat-label {
  font-size: 0.8rem; /* Smaller text */
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 4px; /* Reduced margin */
  text-transform: uppercase;
  letter-spacing: 1px;
}

.stat-value {
  font-size: 1.6rem; /* Slightly smaller */
  font-weight: 700;
  color: #ff0080;
  text-shadow: 0 0 8px #ff0080;
}
/* Character Select overrides for stat emphasis */
.character-select-panel .stat-value {
  color: #E8F8FF;
  text-shadow: 0 0 8px #00ffe5;
}

.weapon-info {
  background: rgba(0, 25, 35, 0.28);
  border: 1px solid rgba(0, 255, 255, 0.25);
  border-radius: 10px;
  padding: 14px 16px;
  margin-bottom: 14px;
  flex-shrink: 0; /* Prevent shrinking */
  width: 100%; /* Full width */
  align-self: stretch; /* Stretch to container width */
  text-align: left; /* Force left alignment */
  box-sizing: border-box; /* Include padding in width calculation */
}
.weapon-core-stats {
  display: grid;
  grid-template-columns: repeat(auto-fill,minmax(90px,1fr));
  gap: 8px;
  margin: 10px 0 14px;
}
.weapon-core-stat { background: rgba(0,0,0,0.35); border:1px solid rgba(0,255,255,0.25); border-radius:6px; padding:6px 8px; display:flex; flex-direction:column; align-items:flex-start; }
.weapon-core-stat .w-label { font-size:0.6rem; letter-spacing:1px; text-transform:uppercase; color:var(--ui-text-muted); }
.weapon-core-stat .w-val { font-size:1.05rem; font-weight:600; color:#9adfff; text-shadow:0 0 6px rgba(0,207,255,0.6); }
.weapon-traits { list-style:none; display:flex; flex-wrap:wrap; gap:6px; margin:4px 0 12px; padding:0; }
.weapon-traits li { font-size:0.65rem; letter-spacing:1px; padding:4px 8px; background:linear-gradient(135deg,rgba(0,255,255,0.15),rgba(0,179,255,0.12)); border:1px solid rgba(0,255,255,0.25); border-radius:999px; text-transform:uppercase; color:#E8F8FF; text-shadow: 0 0 6px rgba(0, 255, 255, 0.25); }
.weapon-lore { font-size:0.85rem; letter-spacing:0.3px; font-style:italic; color:#E6F7FF; background:rgba(0,25,35,0.28); border-left:3px solid #00ffff; padding:10px 12px; border-radius:6px; box-shadow:0 0 8px rgba(0,255,255,0.12) inset; line-height:1.55; }

.weapon-name {
  color: #5EEBFF;
  text-shadow: 0 0 10px rgba(0, 191, 255, 0.35);
  font-weight: 700;
  font-size: 1.3rem;
  margin-bottom: 10px;
  text-align: left; /* Force left alignment */
}

.weapon-description {
  color: rgba(255, 255, 255, 0.8);
  margin-bottom: 15px;
  min-height: 40px; /* Ensure consistent height */
  text-align: left; /* Force left alignment */
}

.weapon-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  width: 100%; /* Full width */
  box-sizing: border-box; /* Include padding in width calculation */
}

.weapon-stat {
  text-align: center;
  padding: 8px;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 5px;
}

.lore-text {
  color: #E6F7FF;
  font-style: italic;
  line-height: 1.7;
  margin-bottom: 16px;
  flex: 1; /* Take up available space */
  width: 100%; /* Full width */
  align-self: stretch; /* Stretch to container width */
  box-sizing: border-box; /* Include padding in width calculation */
}

.lore-quote {
  background: rgba(0, 255, 255, 0.08);
  border-left: 3px solid #00ffff;
  padding: 14px 16px;
  margin: 16px 0;
  font-style: italic;
  color: #9adfff;
  flex-shrink: 0; /* Prevent shrinking */
  width: 100%; /* Full width */
  align-self: stretch; /* Stretch to container width */
  box-sizing: border-box; /* Include padding in width calculation */
}

/* Add a spacer div for consistent tab heights */
.tab-spacer {
  flex: 1;
  min-height: 50px; /* Smaller minimum space */
  width: 100%; /* Full width */
}

.carousel-footer { padding:16px 30px 20px; border-top:2px solid rgba(0,255,255,0.25); background:rgba(0,0,0,0.28); display:flex; justify-content:space-between; align-items:center; flex-shrink:0; }

.select-button {
  background: rgba(0, 0, 0, 0.4);
  border: 2px solid #00ffff;
  color: #00ffff;
  font-family: inherit;
  font-size: 1.1rem;
  font-weight: 700;
  padding: 15px 40px;
  border-radius: 30px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 2px;
  box-shadow: 0 0 16px rgba(0, 255, 255, 0.35);
  position: relative;
  overflow: hidden;
}

.select-button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 28px rgba(0, 255, 255, 0.65);
}

.select-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s ease;
}

.select-button:hover::before {
  left: 100%;
}

.back-button {
  background: rgba(0, 0, 0, 0.8);
  border: 2px solid #00ffff;
  color: #00ffff;
  font-family: inherit;
  font-size: 1.1rem;
  font-weight: 600;
  padding: 12px 25px;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.back-button:hover {
  background: rgba(0, 255, 255, 0.1);
  box-shadow: 0 0 15px #00ffff;
}

/* ===== ANIMATIONS ===== */
@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.7; transform: scale(1.05); }
}

@keyframes slideInLeft {
  from { transform: translateX(-50px); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes slideInRight {
  from { transform: translateX(50px); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.character-display { animation:fadeIn 0.5s ease; }

.nav-arrow.prev:hover {
  animation: slideInLeft 0.3s ease;
}

.nav-arrow.next:hover {
  animation: slideInRight 0.3s ease;
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 1200px) {
  .main-menu-content {
    gap: 50px;
    padding: 30px;
  }
  .carousel-container { padding: 0 12px; }
  .carousel-main { padding: 16px 20px; }
  
  .character-portrait {
    width: 250px;
    height: 250px;
  }
  
  .nav-arrow.prev {
    left: -80px;
  }
  
  .nav-arrow.next {
    right: -80px;
  }
}

@media (max-width: 768px) {
  .carousel-container {
    flex-direction: column;
  }
  
  .info-panel {
    border-left: none;
    border-top: 2px solid rgba(0, 255, 255, 0.3);
    max-height: 300px;
  }
  
  .character-portrait {
    width: 200px;
    height: 200px;
  }
  
  .nav-arrow {
    width: 50px;
    height: 50px;
    font-size: 1.5rem;
  }
  
  .nav-arrow.prev {
    left: -60px;
  }
  
  .nav-arrow.next {
    right: -60px;
  }
  
  .carousel-thumbnails {
    gap: 10px;
  }
  
  .thumbnail {
    width: 60px;
    height: 60px;
  }
}
#character-select-canvas {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  z-index: 0; /* Place behind all other content */
}

/* --- Upgrade Panel Styles --- */
/* Overlay container */
#upgrade-panel.upgrade-panel-overlay {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  /* Match pause overlay translucency + subtle teal tint */
  background: radial-gradient(circle at 30% 25%, rgba(0,40,45,0.30), transparent 65%),
              linear-gradient(145deg, rgba(0,0,0,0.78) 0%, rgba(0,10,14,0.82) 60%, rgba(0,24,28,0.85) 100%);
  backdrop-filter: blur(4px) saturate(135%);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: clamp(12px, 3vw, 40px);
  box-sizing: border-box;
}
#upgrade-panel.upgrade-panel-overlay.hidden { display: none; }

/* Panel shell */
.upgrade-panel.ui-panel {
  display: flex;
  flex-direction: column;
  gap: 20px;
  width: min(1100px, 100%);
  border: 1px solid #00b3a3; /* pause menu border */
  background:
    linear-gradient(145deg, rgba(0,25,28,0.38) 0%, rgba(0,12,14,0.60) 70%),
    repeating-linear-gradient(135deg, rgba(0,255,230,0.05) 0 2px, transparent 2px 6px); /* subtle tech hatch */
  box-shadow: 0 0 28px #00ffdd33, inset 0 0 38px #00ffdd0f; /* mirror pause overlay content glow */
  border-radius: 18px;
  padding: 32px clamp(18px,2.2vw,44px) 28px;
  position: relative;
  overflow: hidden;
  transform: scale(var(--panel-scale, 1));
  transform-origin: center center;
  color:#b3f5e6;
  text-shadow:0 0 6px #00ffaa33;
  animation: panelEnter .55s cubic-bezier(.25,.9,.35,1.2);
}
@keyframes panelEnter { 0% { opacity:0; transform:translateY(18px) scale(.94); } 60% { opacity:1; } 100% { opacity:1; transform:translateY(0) scale(var(--panel-scale,1)); } }
.upgrade-panel.ui-panel:before, .upgrade-panel.ui-panel:after {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
}
.upgrade-panel.ui-panel:before { /* softer interior vignettes */
  background: radial-gradient(circle at 18% 22%, rgba(0,255,230,0.14), transparent 62%),
              radial-gradient(circle at 82% 78%, rgba(0,190,255,0.12), transparent 58%);
  mix-blend-mode: overlay;
}
.upgrade-panel.ui-panel:after { border: 1px solid rgba(255,255,255,0.04); border-radius: inherit; box-shadow: inset 0 0 6px rgba(0,255,255,0.10); }

.upgrade-header { display:flex; flex-direction:column; gap:4px; }
.upgrade-header .panel-title {
  font-family: 'Orbitron', sans-serif;
  font-size: clamp(1.8rem,3.2vw,2.6rem);
  font-weight:700;
  letter-spacing:1px;
  color:#b3f5e6;
  text-shadow:0 0 12px #00ffdd55, 0 0 22px #00b3a355;
  margin:0;
}
.upgrade-hint { font-size:0.75rem; opacity:0.65; letter-spacing:0.08em; text-transform:uppercase; }

.upgrade-options-grid {
  display:grid;
  grid-template-columns: repeat(3, 300px); /* exactly 3 cards per row */
  gap: 22px;
  justify-content:center;
  justify-items:center;
}
.upgrade-options-grid.fixed-three { grid-template-columns:repeat(3,300px)!important; }
.upgrade-options-grid.fixed-three .upgrade-card { width:300px; }
/* Prevent media queries from collapsing columns when fixed-three is present */
@media (max-width: 1280px) {
  .upgrade-options-grid.fixed-three { grid-template-columns:repeat(3,260px)!important; }
  .upgrade-options-grid.fixed-three .upgrade-card { width:260px; }
}
@media (max-width: 980px) {
  .upgrade-options-grid.fixed-three { grid-template-columns:repeat(3,240px)!important; }
  .upgrade-options-grid.fixed-three .upgrade-card { width:240px; }
}
@media (max-width: 780px) {
  .upgrade-options-grid.fixed-three { grid-template-columns:repeat(3,210px)!important; }
  .upgrade-options-grid.fixed-three .upgrade-card { width:210px; height:175px; }
}
@media (max-width: 680px) {
  .upgrade-options-grid.fixed-three { grid-template-columns:repeat(3,190px)!important; }
  .upgrade-options-grid.fixed-three .upgrade-card { width:190px; height:170px; }
}
@media (max-width: 600px) {
  .upgrade-options-grid.fixed-three { grid-template-columns:repeat(3,170px)!important; }
  .upgrade-options-grid.fixed-three .upgrade-card { width:170px; height:160px; padding:10px 10px 30px; }
}
@media (max-width: 540px) {
  .upgrade-options-grid.fixed-three { grid-template-columns:repeat(3,150px)!important; }
  .upgrade-options-grid.fixed-three .upgrade-card { width:150px; height:150px; padding:8px 8px 26px; }
  .upgrade-options-grid.fixed-three .upgrade-icon { width:42px; height:42px; }
  .upgrade-options-grid.fixed-three .upgrade-icon img { width:40px; height:40px; }
  .upgrade-options-grid.fixed-three .upgrade-title { font-size:.8rem; }
  .upgrade-options-grid.fixed-three .upgrade-desc { font-size:.55rem; -webkit-line-clamp:3; line-clamp:3; }
}

/* Responsive scaling tiers for upgrade panel/cards */
@media (max-width: 1280px) {
  .upgrade-panel.ui-panel { width:min(100%, 1000px); }
  .upgrade-options-grid { grid-template-columns: repeat(3, 260px); gap:18px; }
  .upgrade-card { width:260px; height:175px; padding:12px 12px 36px 12px; }
  .upgrade-progress-wrapper { left:12px; right:12px; bottom:8px; }
  .upgrade-icon { width:52px; height:52px; }
  .upgrade-icon img { width:48px; height:48px; }
  .upgrade-title { font-size:.95rem; }
  .upgrade-desc { -webkit-line-clamp:3; line-clamp:3; }
}
@media (max-width: 980px) {
  .upgrade-panel.ui-panel { width:min(100%, 860px); }
  .upgrade-options-grid { grid-template-columns: repeat(2, 260px); }
}
@media (max-width: 640px) {
  .upgrade-panel.ui-panel { width:min(100%, 420px); }
  .upgrade-options-grid { grid-template-columns: repeat(1, 260px); }
}

.upgrade-card {
  --border-color:#00c8bb; /* base weapon/passive border default */
  position:relative;
  display:flex;
  flex-direction:column;
  width:300px;
  height:190px;
  padding:14px 14px 40px 14px;
  background: linear-gradient(145deg, rgba(0,25,28,0.42) 0%, rgba(0,18,24,0.58) 60%, rgba(0,14,20,0.78) 100%);
  border:1px solid var(--border-color);
  border-radius:14px;
  cursor:pointer;
  text-align:left;
  color:#b8f9ef;
  font-family:'Orbitron', sans-serif;
  transition: background .22s ease, transform .18s ease, box-shadow .25s ease, border-color .25s ease, filter .35s ease;
  overflow:hidden;
  backdrop-filter: blur(2px) saturate(125%);
}
.upgrade-card:before {
  content:'';
  position:absolute;
  inset:0;
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0));
  opacity:0.4;
  pointer-events:none;
}
.upgrade-card:after {
  content:'';
  position:absolute;
  left:0; top:0; bottom:0;
  width:4px;
  background: linear-gradient(180deg, var(--border-color), transparent 78%);
  opacity:0.9;
  box-shadow:0 0 12px -2px var(--border-color);
}
.upgrade-card:hover, .upgrade-card:focus-visible {
  outline:none;
  transform: translateY(-4px) scale(1.025);
  box-shadow:0 0 0 1px var(--border-color), 0 0 20px 4px rgba(0,255,230,0.55), 0 0 40px -6px var(--border-color);
  background: linear-gradient(155deg, rgba(0,45,52,0.72) 0%, rgba(0,33,40,0.78) 55%, rgba(0,26,32,0.9) 100%);
  filter:brightness(1.08);
}
.upgrade-card.is-weapon { --border-color:#00e6d7; }
/* Passive: slightly cooler green-blue */
.upgrade-card.is-passive { --border-color:#00c0a0; }
/* Evolved weapon: dark red neon frame */
.upgrade-card.is-evolved { --border-color:#ff4d4d; box-shadow:0 0 0 1px #ff4d4d, 0 0 26px 6px rgba(255,77,77,0.35); }
.upgrade-card.is-evolved .upgrade-key-indicator { border-color:#ff4d4d; color:#ff8080; text-shadow:0 0 6px #ff4d4d; }
.upgrade-card.is-evolved .upgrade-title { color:#ffe3e3; text-shadow:0 0 10px rgba(255,77,77,.65); }
.upgrade-card.is-evolved .upgrade-icon img { filter: drop-shadow(0 0 10px rgba(255,77,77,0.7)); }
/* Class weapon: brighter cyan core + subtle animated pulse */
.upgrade-card.is-class { --border-color:#26ffe9; animation: classPulse 2.4s ease-in-out infinite; box-shadow:0 0 0 1px #26ffe9, 0 0 26px 6px #26ffe94d; }
@keyframes classPulse { 0%,100% { box-shadow:0 0 0 1px #26ffe9, 0 0 20px 4px #26ffe933; } 50% { box-shadow:0 0 0 1px #26ffe9, 0 0 34px 8px #26ffe977; } }

.upgrade-key-indicator {
  position:absolute;
  top:8px; left:10px;
  width:30px; height:30px;
  display:flex; align-items:center; justify-content:center;
  font-size:0.9rem; font-weight:600;
  background: linear-gradient(140deg,#0a2226,#10363e);
  border:1px solid var(--border-color);
  border-radius:8px;
  color: var(--border-color);
  text-shadow:0 0 6px var(--border-color);
  box-shadow:0 0 10px var(--border-color) inset, 0 0 10px -2px var(--border-color);
}
.upgrade-icon { width:56px; height:56px; flex:0 0 auto; display:flex; align-items:center; justify-content:center; margin-bottom:4px; }
.upgrade-icon.top-right { position:absolute; top:8px; right:10px; margin-bottom:0; }
.upgrade-icon.top-right img { width:48px; height:48px; }
.upgrade-icon img { width:52px; height:52px; object-fit:contain; filter: drop-shadow(0 0 6px rgba(0,255,255,0.5)); }
/* Passive (green arrow) SVG styling */
.upgrade-icon .passive-arrow { filter: drop-shadow(0 0 6px #00ff99) drop-shadow(0 0 12px #00ff9966); }
/* Passive icon framed (orange theme) */
/* Passive icon inherits same base frame; only glow tint differs */
.upgrade-card.is-passive .upgrade-icon.top-right { top:8px; right:10px; }
.upgrade-card.is-passive .upgrade-icon.top-right .passive-arrow { width:52px; height:52px; }
/* When icon is top-right, push text body below it */
.upgrade-icon.top-right + .upgrade-body { margin-top:50px; }
@media (max-width: 780px) { .upgrade-icon.top-right + .upgrade-body { margin-top:46px; } }
@media (max-width: 600px) { .upgrade-icon.top-right + .upgrade-body { margin-top:42px; } }
.upgrade-body { flex:1; display:flex; flex-direction:column; gap:4px; overflow:hidden; }
.upgrade-row { display:flex; justify-content:space-between; gap:10px; align-items:flex-start; }
.upgrade-title-line { display:flex; gap:8px; align-items:center; flex-wrap:nowrap; }
.upgrade-title { font-size:1.05rem; letter-spacing:.5px; font-weight:600; color:#e6fffb; text-shadow:0 0 6px rgba(0,255,240,0.55); line-height:1.05; }
.upgrade-type-line { font-size:.6rem; opacity:.75; letter-spacing:.15em; text-transform:uppercase; font-weight:500; }
.upgrade-desc { font-size:.70rem; line-height:1.15; opacity:.84; font-weight:400; flex:1; overflow:hidden; display:-webkit-box; -webkit-line-clamp:4; line-clamp:4; -webkit-box-orient:vertical; }

/* Adaptive text scaling inside fixed box */
 .upgrade-card .upgrade-title, .upgrade-card .upgrade-desc { transition: font-size .15s ease; }
.upgrade-card[data-text-small="1"] .upgrade-title { font-size:.95rem; }
.upgrade-card[data-text-small="1"] .upgrade-desc { font-size:.64rem; }
.upgrade-card[data-text-small="2"] .upgrade-title { font-size:.88rem; }
.upgrade-card[data-text-small="2"] .upgrade-desc { font-size:.58rem; }

.badge { display:inline-flex; align-items:center; justify-content:center; font-size:.55rem; line-height:1; padding:4px 6px 3px; border-radius:6px; letter-spacing:.05em; font-weight:600; text-transform:uppercase; background:#222; border:1px solid currentColor; }
.badge-weapon { color:#00e6d7; background:linear-gradient(140deg,#022e33,#034148); }
.badge-passive { color:#00c0a0; background:linear-gradient(140deg,#01312d,#034d45); }
.badge-class { color:#26ffe9; background:linear-gradient(140deg,#023a41,#04535c); }
.badge-skip { color:#8aa1b1; background:linear-gradient(140deg,#202a32,#2e3a44); }

.upgrade-progress-wrapper { position:absolute; left:14px; right:14px; bottom:10px; display:flex; justify-content:center; }
.upgrade-progress { position:relative; width:100%; max-width:260px; height:12px; background:rgba(0,255,255,0.08); border:1px solid rgba(0,255,255,0.28); border-radius:6px; overflow:hidden; }
.upgrade-progress-bar { position:absolute; top:0; left:0; bottom:0; width:var(--progress,0%); background:linear-gradient(90deg,#00ffe5,#00b3ff 85%); box-shadow:0 0 10px #00ffe5; }
.upgrade-progress-bar[data-progress] { transition:width .25s ease; }
.upgrade-progress-text { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:.6rem; font-weight:600; letter-spacing:.08em; color:#fff; text-shadow:0 0 6px #000; mix-blend-mode:screen; }

.upgrade-footer { display:flex; justify-content:space-between; align-items:center; padding-top:10px; border-top:1px solid rgba(255,255,255,0.08); font-size:.58rem; letter-spacing:.14em; text-transform:uppercase; opacity:.75; }
.legend { display:none; }
.footer-hints { opacity:.65; font-weight:500; }

@media (max-width: 860px) {
  .upgrade-panel.ui-panel { padding:22px 16px 18px; }
  .upgrade-options-grid { grid-template-columns:1fr; }
  .upgrade-card { padding:14px 14px 16px 50px; }
  .upgrade-icon { width:50px; }
  .upgrade-title { font-size:.95rem; }
  .upgrade-desc { font-size:.7rem; }
}

/* --- Responsive Adjustments for AAA Feel --- */
@media (max-width: 1600px) {
  .character-select-content {
    gap: 20px;
  }
  .character-grid {
    min-width: 500px;
    max-width: 700px;
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    gap: 10px;
    padding: 14px 10px;
  }
  .character-box {
    min-width: 80px;
    min-height: 50px;
    font-size: 0.8em;
    padding: 8px 4px;
  }
  .character-info-box {
    min-width: 250px;
    max-width: 350px;
    padding: 15px 20px;
    font-size: 0.9em;
  }
  .menu-title {
    font-size: 2.2em;
    margin-bottom: 15px;
  }
  .character-select-actions {
    gap: 10px;
    margin-top: 20px;
  }
  .menu-button {
    font-size: 1.2em;
    padding: 8px 20px;
    min-width: 120px;
    max-width: 200px;
  }
}

@media (max-width: 1200px) {
  .character-select-content {
    flex-direction: column; /* Stack vertically on smaller screens */
    align-items: center;
    gap: 15px;
  }
  .character-grid-and-buttons {
    max-width: 100%;
  }
  .character-grid {
    min-width: 90vw;
    max-width: 90vw;
    grid-template-columns: repeat(2, 1fr); /* 2 columns on very small screens */
    grid-template-rows: repeat(6, 1fr);
    gap: 8px;
    padding: 8px 1px;
  }
  .character-info-box {
    min-width: 80vw;
    max-width: 90vw;
    min-height: 100px;
    padding: 12px 6px;
    font-size: 0.8em;
  }
  .character-select-actions {
    flex-direction: column;
    gap: 8px;
  }
  .menu-button {
    width: 100%;
    max-width: 200px;
  }
}

@media (max-width: 768px) {
  .menu-title {
    font-size: 1.8em;
    margin-bottom: 10px;
  }
  .character-grid {
    grid-template-columns: repeat(1, 1fr); /* Single column on tiny screens */
    grid-template-rows: repeat(12, 1fr);
    gap: 6px;
    padding: 6px 1px;
  }
  .character-box {
    min-width: 80px;
    min-height: 50px;
    font-size: 0.7em;
    padding: 6px 3px;
  }
  .character-portrait {
    width: 40px;
    height: 40px;
    margin-bottom: 6px;
  }
  .character-info-box {
    min-width: 80vw;
    padding: 10px 5px;
    font-size: 0.7em;
  }
  .menu-button {
    font-size: 1em;
    padding: 6px 15px;
    min-width: 100px;
  }
}
